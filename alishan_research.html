<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阿里山林業鐵路選址策略與災害潛勢分析</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paper: '#F9F7F2',       // 米黃色背景
                        forest: '#2F5D40',      // 深森林綠
                        soil: '#8D6E63',        // 土壤棕
                        ink: '#2D2D2D',         // 深灰
                        gold: '#bfa384',        // 阿里山金
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'], 
                        sans: ['"Noto Sans TC"', 'sans-serif'], 
                    }
                }
            }
        }
    </script>

    <style>
        /* 全局設定 */
        body {
            background-color: #F9F7F2;
            color: #2D2D2D;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden; 
        }

        /* --- Hero 動畫區 --- */
        #hero-container {
            position: relative;
            width: 100%;
            height: 100vh; /* 全螢幕高度 */
            background: #F9F7F2;
            overflow: hidden;
        }

        #hero-canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: transparent;
        }

        /* --- 懸浮標題樣式 (含半透明背板) --- */
        .hero-overlay {
            position: absolute;
            /* 手機版設定：往上移一點 (15%)，避免壓到內文 */
            top: 15%; 
            left: 50%;
            transform: translateX(-50%);
            width: 90%; /* 手機版寬度 */
            max-width: 800px; /* 電腦版最大寬度 */
            text-align: center;
            z-index: 20;
            pointer-events: none;
            
            /* 半透明毛玻璃背板 */
            background-color: rgba(0, 0, 0, 0.4); 
            backdrop-filter: blur(4px); 
            /* 手機版內距縮小 (1.5rem)，讓框變矮 */
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* 電腦版調整：螢幕較大時回復較大的內距和位置 */
        @media (min-width: 768px) {
            .hero-overlay {
                top: 20%;
                padding: 2rem;
            }
        }

        .hero-title-main {
            font-family: 'Noto Serif TC', serif;
            font-size: 2rem; 
            font-weight: 700;
            color: #bfa384; 
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .hero-subtitle {
            font-family: 'Noto Serif TC', serif;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 400;
            letter-spacing: 0.05em;
        }

        @media (min-width: 768px) {
            .hero-title-main { font-size: 3rem; }
            .hero-subtitle { font-size: 1.2rem; }
        }

        /* --- 原有報告 UI --- */
        #progress-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 6px;
            background: transparent; z-index: 50;
        }
        #progress-bar {
            height: 100%; background: #2F5D40; width: 0%; transition: width 0.1s;
        }

        .hanging-indent { padding-left: 2em; text-indent: -2em; margin-bottom: 0.5em; }
        .lightbox-overlay { transition: opacity 0.3s ease; }
        img { max-width: 100%; height: auto; border-radius: 4px; }
        #back-to-top:focus { outline: 4px solid #8D6E63; outline-offset: 2px; }
        
        .pdf-viewer {
            width: 100%; height: 700px;
            border: 1px solid #ccc; border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .timelapse-wrapper {
            position: relative; width: 100%; padding-bottom: 56.25%; 
            background-color: #d8e3e6; border-radius: 0.5rem;
            overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .timelapse-wrapper img.tl-frame {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; z-index: 1; 
            transition: none; will-change: opacity;
        }
        .timelapse-wrapper img.tl-frame.active { opacity: 1; z-index: 10; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px;
            border-radius: 50%; background: #2F5D40; 
            cursor: pointer; margin-top: -8px; 
            border: 2px solid #F9F7F2; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer;
            background: #d1d5db; border-radius: 2px;
        }
    </style>
</head>
<body class="font-sans text-lg md:text-xl leading-relaxed selection:bg-forest selection:text-white">

    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <div id="hero-container">
        <div class="hero-overlay">
            <h1 class="hero-title-main">
                阿里山林業鐵路<br>選址策略與災害潛勢分析
            </h1>
            <div class="hero-subtitle">
                <p>國立嘉義大學數位學習設計與管理學系</p>
                <div class="mt-4 border-t border-white/20 pt-4 flex flex-col md:flex-row justify-center gap-2 md:gap-6 text-sm md:text-base opacity-90">
                    <p>作者：葉怡嫻、朱書靚、劉芷瑩</p>
                    <p>指導教授：李佩倫 教授</p>
                </div>
            </div>
        </div>
        
        <canvas id="hero-canvas"></canvas>
    </div>

    <main class="max-w-3xl mx-auto px-6 py-12 relative z-10 -mt-32 md:-mt-48">

        <section class="mb-12">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-6 border-l-4 border-soil pl-4">壹、林鐵選址與土地利用</h2>
            
            <p class="mb-6 text-justify">
                阿里山林業鐵路的興建與選址策略是日本殖民政府進行大規模山林資源開發與殖民統治的重要政策產物。為了有效率地運送阿里山地區豐富的森林資源，選線不僅考量了地理條件，更與資源的空間分佈及經營策略的轉變有密切相關。早在1899年，勘查報告即指出阿里山地區蘊藏有巨量的原始森林，估計針葉林材積達 798,649 立方公尺，闊葉林材積達 1,728,660 立方公尺。當時總督府決定採用美國式鐵道運材方案來運輸材積大且長度長的珍貴紅檜。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/ksySn2jb/image.png" alt="圖一、阿里山林鐵選址與林木資源空間分佈疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖一、阿里山林鐵選址與林木資源空間分佈疊合圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                早期的探勘路線（如飯田豐二等人經清水溪上游的路線）雖然路徑較短，但失敗的原因可以從多重地理視角獲得驗證。從高度剖面圖比較（圖二）可見，該路線末端幾乎呈垂直爬升，與現行路線透過迂迴展線所達到的平緩坡度形成強烈對比。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/qYS5HfVp/image.png" alt="圖二、探勘路線與現行路線高度剖面圖比較" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖二、探勘路線與現行路線高度剖面圖比較
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                進一步檢視地形分析圖（圖三），可以發現探勘路線最終止於等高線極度密集的區域，也就是「大塔山斷崖」。這些險峻的地理特徵形成了天然屏障，迫使工程團隊必須放棄直線捷徑。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/HD4fLjdq/image.png" alt="圖三、清水溪探勘路線與大塔山斷崖地形分析圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖三、清水溪探勘路線與大塔山斷崖地形分析圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                而從豐山休息區視角的 3D 地形圖（圖四），更能直觀感受到大塔山斷崖的險峻程度。種種難關迫使總督府放棄此案，轉而採用林學博士河合鈰太郎規劃的阿里山側路線，雖然路程較長，但能通過螺旋與之字形設計克服海拔落差。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/7NB49085/image.png" alt="圖四、豐山休息區看大塔山斷崖圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖四、豐山休息區看大塔山斷崖圖
                </figcaption>
            </figure>
        </section>

        <section class="mb-16 bg-white p-6 rounded-lg shadow-lg border border-gray-200">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 flex items-center">
                <span class="mr-2">⏱️</span> 時序地貌變遷模擬
            </h3>
            <p class="mb-4 text-base text-gray-600">
                透過下方的時間軸滑桿，您可以動態觀察該區域隨時間推移的地貌變化。
            </p>
            
            <div class="viewer-container w-full relative">
                
                <div class="timelapse-wrapper mb-4" id="tl-imageContainer">
                    <div class="absolute inset-0 flex items-center justify-center text-gray-500 z-10" id="tl-loadingText">
                        影像載入中...
                    </div>
                </div>

                <img src="https://i.ibb.co/TMM4h7pN/message-Image-1766500338049.jpg" 
                     alt="災害潛勢圖例" 
                     class="mx-auto mb-4 w-48 rounded shadow-sm border border-gray-200
                            md:absolute md:top-4 md:right-4 md:w-32 md:mb-0 md:shadow-lg md:bg-white/90 md:z-50 pointer-events-none select-none">
                <div class="controls flex flex-col gap-4">
                    <input type="range" id="tl-slider" min="0" max="48" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    
                    <div class="flex justify-between items-center">
                        <button id="tl-playBtn" class="bg-forest hover:bg-[#234a31] text-white font-medium py-2 px-6 rounded transition-colors flex items-center gap-2 shadow-md">
                            <span>▶ 播放</span>
                        </button>
                        <div class="text-soil font-serif font-bold text-lg">
                            <span id="tl-currentIdx">0000</span> / 0048
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">二、選線工法與經營策略的轉變</h3>
            
            <p class="mb-6 text-justify">
                阿里山林鐵的選址面臨海拔落差超過 2,000 公尺的挑戰。林學博士河合鈰太郎致力於打造一條具備世界級水準的登山鐵道。如圖五所示，河合在獨立山路段的規劃上採用了複雜的螺旋線工法，讓鐵路盤旋而上。這項設計旨在將坡度控制在千分之 50 的理想範圍內，以確保路線的永續經營。此外，林鐵路線涵蓋了低海拔的樟腦林與高海拔的檜木林，證明鐵路位置是為了配合當時主要的林業生產活動。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/LhCm77Wr/image.png" alt="圖五、獨立山螺旋路線與樟腦產業範圍疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖五、獨立山螺旋路線與樟腦產業範圍疊合圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                隨著天然林資源的持續開採，阿里山林業的經營環境在 1930 年代面臨轉型。約在 1934 年，素材生產成本優勢逐漸被太平山和八仙山超越，單純依賴伐木已難以維持龐大營運利益。然而，阿里山獨特的雲海與高山景觀展現了新機。1927 年阿里山入選臺灣八景，促使營林所轉向觀光鐵路策略。1931 年，林鐵客運收入首次超越貨運收入，形成黃金交叉，標誌著這條鐵路從單一運材工具，正式轉型為具備現代觀光價值的世界級登山鐵道。
            </p>
        </section>

        <div class="my-16 bg-white p-4 rounded-lg shadow-inner border border-gray-200">
            <h4 class="text-center font-serif text-forest mb-2 font-bold">林鐵全線海拔高度變化</h4>
            <figure class="group cursor-zoom-in">
                <img src="https://i.ibb.co/YB8776SG/image.png" alt="阿里山林鐵全線剖面圖" class="w-full">
            </figure>
        </div>

        <section class="mb-12">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-6 border-l-4 border-soil pl-4">貳、林鐵與自然災害</h2>
            <p class="mb-6 text-justify">
                阿里山林業鐵路在選址時雖然成功克服了地形高差，串聯起林業資源，但這種以經濟效益與工程征服為主要考量的決策，卻讓路線不得不穿越許多地質敏感地帶。透過歷史災害紀錄與現代地理資訊系統（GIS）的疊合分析，我們可以看見鐵路興建所帶來的環境代價與長期風險。
            </p>

            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">一、經濟選址的地質代價：獨立山螺旋路段</h3>
            
            <p class="mb-6 text-justify">
                獨立山螺旋路段所在區域，地質上大多屬於不穩定的崩積層與破碎帶。從 GIS 疊圖（圖六）可以看出，軌道沿線與「山崩與地滑敏感區」及「土石流潛勢溪流」高度重疊。為了維持這條盤旋而上的路線，工程單位在破碎的邊坡上進行了大量開挖與路基建設，導致該路段自通車以來經常面臨落石與坍方威脅。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/JWPpYMMJ/image.jpg" alt="圖六、獨立山段地質災害潛勢圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖六、獨立山段地質災害潛勢圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                除了先天脆弱的地質條件，後天的人為農業開發更加劇了邊坡的不穩定性。對照疊合圖（圖七）顯示，該區域有大量的檳榔種植分布。檳榔樹冠截留雨水能力極低（僅約降雨量的 6.3%），且屬於淺根系植物，抓地力遠不如天然林木。研究顯示，檳榔園的年平均土壤流失量可達森林地的 10 倍以上。因此，在易發生山崩地滑的敏感區大面積種植檳榔，大幅削弱了坡面的抗災能力，是誘發邊坡坍方的重要人為因素。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/YTF9P8Qz/image.jpg" alt="圖七、獨立山段地質災害潛勢區及檳榔種植分布疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖七、獨立山段地質災害潛勢區及檳榔種植分布疊合圖
                </figcaption>
            </figure>
        </section>

        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">二、速成工法的後遺症：二萬坪順向坡危機</h3>
            
            <p class="mb-6 text-justify">
                相較於獨立山的精心規劃，高海拔段為了追求快速完工而採用的「之字形」工法，其環境代價更加明顯。二萬坪車站及周邊的之字形軌道，完全座落在一個大規模的「順向坡山崩地滑區」（圖八）。順向坡地形因為岩層傾向與坡面一致，一旦失去坡腳支撐或遭遇豪雨，極易發生大規模滑動。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/F4C5HHry/image.jpg" alt="圖八、二萬坪至屏遮那段地質分析圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖八、二萬坪至屏遮那段地質分析圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                該區域也標示有明顯的洪患風險。歷史紀錄顯示，二萬坪地區自鐵路通車後（如 1912 年通車初期及近年的莫拉克風災）多次發生嚴重走山與路基流失事件。這顯示當年為了利用平緩地形進行之字形爬升，卻忽視了順向坡的潛在危機，等於埋下了百年來的災害隱憂。
            </p>
        </section>

        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">三、開發的長期環境效應：眠月線的時空變遷</h3>
            
            <p class="mb-6 text-justify">
                林鐵的開發與維護，始終與劇烈的地質作用相互角力。透過關鍵時間點的衛星影像監測（圖九），我們可以具體觀察到重大地質災害事件對山區設施的瞬間衝擊。對比 1996 年（災前）與 1999 年（921 震後）的衛星影像，1996 年時眠月線沿線森林覆蓋完整；但在 1999 年影像中，鐵路沿線出現劇烈變化，原本翠綠的植被被大量灰白色崩塌裸露地取代，切斷了路基與隧道口。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/35gMZ814/image.jpg" alt="圖九、1996年災前與1999年震後眠月線衛星影像崩塌對比圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖九、1996年災前與1999年震後眠月線衛星影像崩塌對比圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                這顯示眠月線選址穿越了大量潛在地質敏感區。在相對穩定的時期，植被尚能維持邊坡表面穩定，一旦遭遇極端地質事件（如 921 大地震），脆弱的地質構造便無法承受強烈應力搖晃，導致大規模滑動。這也驗證了早期「資源優先」的選址策略，在面對不可抗力的天然災害時，缺乏足夠的抗災韌性。
            </p>
        </section>

        <hr class="border-t-2 border-forest opacity-30 my-12">

        <section class="mb-12">
            <h2 class="font-serif text-2xl font-bold text-forest mb-6">參、參考資料</h2>
            <div class="text-base text-gray-600 font-serif leading-relaxed">
                <p class="hanging-indent">蔡龍保 (2023)。由森林鐵路到觀光鐵路：日治時期阿里山鐵路經營策略之轉變(1896-1945)。《地理學報》，(105):103-137。</p>
                <p class="hanging-indent">蔡佩蓉 (2023)。從帝國森林到帝國風景：阿里山的空間生產與文化想像(1896-1937)。[博士論文]，成功大學歷史學系。</p>
                <p class="hanging-indent">蘇昭旭 (n.d.)。日治時期的森林鐵道——以阿里山森鐵為例。《台灣林業》，頁142-147。</p>
                <p class="hanging-indent">蘇昭旭 (n.d.)。河合鈰太郎與阿里山森林鐵路的誕生。《台灣林業》，頁127-141。</p>
                <p class="hanging-indent">趙衛君 (2005)。應用高斯過程建立分階式山區道路邊坡崩塌預測模式之研究-以阿里山公路為例。[碩士學位論文]，國立台灣科技大學營建工程系。</p>
                <p class="hanging-indent">周庭億 (2025)。以大尺寸邊坡模型探討二萬坪崩塌地大規模滑動過程之研究。[碩士論文]，國立雲林科技大學營建工程系。</p>
                <p class="hanging-indent">周光永 (2017)。山區公路防災預警機制推行效益之研究-以阿里山公路為例。[碩士學位論文]，東南科技大學營建與空間設計系碩士班。</p>
                <p class="hanging-indent">胡逸舟 (2011)。降雨引致山區道路邊坡崩塌潛勢之研究-以阿里山公路為例。[博士學位論文]，國立台灣科技大學營建工程系。</p>
                <p class="hanging-indent">李嶸泰、蕭大凱、黃清榮、楊宏章與沈彥俊 (2012)。阿里山森林鐵路災害調查及復建規劃。《中華水土保持學報》，43(2):123-138。</p>
                <p class="hanging-indent">羅大為與吳志展 (2011)。阿里山森林鐵路路基之破壞原因與邊坡穩定治理工法之初步探討-以森林鐵路 42k+940~43k+040 為例。《水土保持學報》，43(2):219-228。</p>
                <p class="hanging-indent">蕭鈺達 (2015)。阿里山區晚第四紀山崩土石流紀錄與河流地形變遷。[碩士論文]，國立中正大學地球與環境科學系地震學碩士班。</p>
                <p class="hanging-indent">王國榮 (2021)。整合監測資料與邊坡穩定分析之一種經驗性邊坡預警準則。[博士論文]，國立成功大學土木工程學系。</p>
                <p class="hanging-indent">林壯沛 (2001)。坡地種植檳榔對台灣中部山區集水區水文特性影響之研究。[博士論文]，國立中興大學水土保持學系。</p>
                <p class="hanging-indent">陳瑞全 (2014)。應用航照數位影像探討嘉義山區檳榔作物的空間分布。[碩士論文]，國立嘉義大學森林暨自然資源學系研究所。</p>
                <p class="hanging-indent">經濟部中央地質調查所 (2024)。地質敏感區查詢系統[山崩與地滑地質敏感區、順向坡]。</p>
                <p class="hanging-indent">中央研究院人社中心地理資訊科學研究專題中心 (2024)。台灣百年歷史地圖系統[1904年臺灣堡圖、1916年蕃地地形圖]。</p>
            </div>
        </section>

        <section class="mb-20">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-8 border-l-4 border-soil pl-4">肆、專題成果展示與下載</h2>
            
            <div class="space-y-12">
                <div class="bg-paper p-6 rounded-lg shadow-xl border border-forest/20">
                    <h3 class="font-serif text-xl font-bold text-forest mb-4">專題文檔（完整版 PDF 預覽）</h3>
                    <p class="text-sm text-soil mb-4">
                        文件 ID: 1WYyuQXclCp9-xXo51Z4mUZOlSk8tK2HN
                    </p>
                    <iframe 
                        src="https://drive.google.com/file/d/1WYyuQXclCp9-xXo51Z4mUZOlSk8tK2HN/preview" 
                        class="pdf-viewer" 
                        frameborder="0"
                        title="專題文檔 PDF 預覽"
                    >
                        <p>您的瀏覽器不支援內嵌框架 (iframe)。請點擊 <a href="https://drive.google.com/file/d/1WYyuQXclCp9-xXo51Z4mUZOlSk8tK2HN/view?usp=sharing" class="text-forest underline" target="_blank">此處下載文檔 PDF</a>。</p>
                    </iframe>
                    <div class="mt-4 text-center">
                        <a href="https://drive.google.com/file/d/1WYyuQXclCp9-xXo51Z4mUZOlSk8tK2HN/view?usp=sharing" download class="inline-block bg-soil text-white font-sans font-medium py-2 px-6 rounded hover:bg-soil/90 transition-colors">
                            下載專題文檔 PDF
                        </a>
                    </div>
                </div>

                <div class="bg-paper p-6 rounded-lg shadow-xl border border-forest/20">
                    <h3 class="font-serif text-xl font-bold text-forest mb-4">專題海報（PDF 預覽）</h3>
                    <p class="text-sm text-soil mb-4">
                        海報 ID: 1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a
                    </p>
                    <iframe 
                        src="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/preview" 
                        class="pdf-viewer" 
                        frameborder="0"
                        title="專題海報 PDF 預覽"
                    >
                        <p>您的瀏覽器不支援內嵌框架 (iframe)。請點擊 <a href="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/view?usp=sharing" class="text-forest underline" target="_blank">此處下載海報 PDF</a>。</p>
                    </iframe>
                    <div class="mt-4 text-center">
                        <a href="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/view?usp=sharing" download class="inline-block bg-soil text-white font-sans font-medium py-2 px-6 rounded hover:bg-soil/90 transition-colors">
                            下載專題海報 PDF
                        </a>
                    </div>
                </div>
            </div>
<div class="mb-12 bg-forest/10 p-8 rounded-lg border border-forest border-dashed text-center">
    <h3 class="font-serif text-2xl font-bold text-forest mb-4">✨ 互動專區：林鐵知識大考驗</h3>
    <p class="mb-6 text-gray-700">
        閱讀完報告後，想知道自己吸收了多少嗎？<br>
        我們準備了 5 題關於林鐵選址與災害的小測驗，歡迎來挑戰！
    </p>
    <a href="quiz.html" class="inline-flex items-center gap-2 bg-forest hover:bg-[#234a31] text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105">
        <span class="text-xl">👉</span>
        <span>前往挑戰測驗</span>
    </a>
</div>
        </section>
        <footer class="text-center text-sm text-gray-500 py-8 border-t border-gray-300">
            <p>© 2024 國立嘉義大學數位學習設計與管理學系專題製作</p>
        </footer>

    </main>

    <button id="back-to-top" class="fixed bottom-6 right-6 bg-forest text-white p-4 rounded-full shadow-lg opacity-0 transition-opacity duration-300 hover:bg-opacity-90 z-40 hidden md:block" aria-label="回到頂部" title="回到頂部 (Top)">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden flex justify-center items-center opacity-0 lightbox-overlay" role="dialog" aria-modal="true">
        <button id="lightbox-close" class="absolute top-4 right-4 text-white p-2 hover:text-soil transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <div class="max-w-5xl max-h-screen p-4 flex flex-col items-center">
            <img id="lightbox-img" src="" alt="放大預覽" class="max-h-[85vh] w-auto object-contain rounded shadow-2xl">
            <p id="lightbox-caption" class="text-gray-300 mt-4 text-lg font-serif text-center"></p>
        </div>
    </div>

    <script>
        // ----------------------------------------------------
        // Part A: 阿里山火車 Canvas 動畫邏輯 (極簡優化版)
        // ----------------------------------------------------
        (function() {
            const canvas = document.getElementById('hero-canvas');
            const container = document.getElementById('hero-container');
            const ctx = canvas.getContext('2d', { alpha: true });

            let w, h;
            let frame = 0;
            let time = 0;

            const PI = Math.PI;
            const TWO_PI = PI * 2;

            function random(min, max) { return Math.random() * (max - min) + min; }
            function noise(x, seed) {
                return Math.sin(x * 0.01 + seed) * 1.0 + 
                       Math.sin(x * 0.03 + seed * 2) * 0.5 + 
                       Math.sin(x * 0.1 + seed * 3) * 0.25;
            }

            const CONFIG = {
                color: {
                    skyTop: '#0B1026', skyHori: '#632B26', sun: '#F2C94C',
                    mountains: ['#080A10', '#121621', '#1D2536', '#252F42', '#182012'],
                    alishanRed: '#B92B27', alishanYellow: '#F2C94C',
                },
                speed: 1.2,
                groundY: 0.6, 
                whiteSpaceH: 0.25,
                sakuraCount: 100 
            };

            // 粒子與物件類別 (保持不變)
            class Sakura {
                constructor() { this.reset(true); }
                reset(initial = false) {
                    this.x = initial ? random(0, w) : random(w, w + 200);
                    this.y = random(0, h * (1 - CONFIG.whiteSpaceH)); 
                    this.z = random(0.5, 2.0);
                    this.size = random(3, 6);
                    this.vx = random(-1.5, -0.5) * this.z * CONFIG.speed;
                    this.vy = random(0.2, 0.8) * this.z;
                    this.angleX = random(0, TWO_PI); this.angleY = random(0, TWO_PI);
                    this.velRotX = random(0.01, 0.05); this.velRotY = random(0.01, 0.05);
                    this.color = `rgba(255, ${Math.floor(random(180, 220))}, ${Math.floor(random(200, 240))}, ${random(0.6, 0.9)})`;
                }
                update() {
                    this.x += this.vx; this.y += this.vy;
                    this.angleX += this.velRotX; this.angleY += this.velRotY;
                    this.x += Math.sin(time * 0.002 + this.y * 0.01) * 0.5;
                    if (this.x < -20 || this.y > h * (1 - CONFIG.whiteSpaceH)) this.reset();
                }
                draw() {
                    let scaleX = Math.abs(Math.cos(this.angleX));
                    let scaleY = Math.abs(Math.sin(this.angleY));
                    ctx.save(); ctx.translate(this.x, this.y); ctx.fillStyle = this.color;
                    if (this.z > 1.5) { ctx.shadowBlur = 5; ctx.shadowColor = this.color; }
                    ctx.beginPath();
                    ctx.ellipse(0, 0, this.size * scaleX * this.z, this.size * scaleY * this.z, Math.PI/4, 0, TWO_PI);
                    ctx.fill(); ctx.restore();
                }
            }

            class Steam {
                constructor(x, y, vx) {
                    this.x = x; this.y = y; this.vx = vx + random(-0.5, 0.5);
                    this.vy = random(-1, -2); this.life = 1.0; this.decay = random(0.005, 0.01);
                    this.size = random(5, 15); this.grow = random(0.2, 0.4);
                }
                update() {
                    this.x += this.vx; this.y += this.vy; this.vx *= 0.98;
                    this.size += this.grow; this.life -= this.decay; this.vy *= 0.99;
                }
                draw() {
                    if (this.life <= 0) return;
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.life * 0.25})`;
                    ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, TWO_PI); ctx.fill();
                }
            }

            class Carriage {
                constructor(offsetX) {
                    this.baseOffsetX = offsetX; 
                    this.width = 160; this.height = 70;
                }
                draw(locoX, locoY, wheelRot) {
                    const cx = locoX + this.baseOffsetX; const cy = locoY;
                    ctx.save(); ctx.translate(cx, cy);
                    ctx.fillStyle = 'rgba(0,0,0,0.4)'; ctx.filter = 'blur(8px)'; ctx.fillRect(10, -5, this.width-20, 15); ctx.filter = 'none';
                    const drawBogie = (bx) => {
                        ctx.save(); ctx.translate(bx, -15);
                        ctx.fillStyle = '#222'; ctx.fillRect(-25, -5, 50, 10);
                        const drawWheel = (wx) => {
                            ctx.save(); ctx.translate(wx, 0); ctx.rotate(wheelRot);
                            ctx.fillStyle = '#111'; ctx.beginPath(); ctx.arc(0,0,14,0,TWO_PI); ctx.fill();
                            ctx.strokeStyle = '#444'; ctx.lineWidth=2; ctx.beginPath();
                            for(let i=0; i<4; i++) { ctx.rotate(PI/2); ctx.moveTo(0,0); ctx.lineTo(14,0); }
                            ctx.stroke(); ctx.restore();
                        };
                        drawWheel(-18); drawWheel(18); ctx.restore();
                    };
                    drawBogie(40); drawBogie(this.width - 40);
                    ctx.fillStyle = CONFIG.color.alishanRed; ctx.fillRect(0, -15 - this.height, this.width, this.height);
                    ctx.fillStyle = CONFIG.color.alishanYellow; ctx.fillRect(0, -15 - this.height/2, this.width, 5);
                    ctx.fillStyle = '#2C3E50'; const windowWidth = 25; const gap = 10;
                    for(let i=0; i<4; i++) {
                        ctx.fillRect(15 + i*(windowWidth+gap), -15 - this.height + 15, windowWidth, 20);
                        ctx.strokeStyle = 'rgba(255,255,255,0.2)'; ctx.lineWidth = 1; ctx.strokeRect(15 + i*(windowWidth+gap), -15 - this.height + 15, windowWidth, 20);
                    }
                    ctx.fillStyle = '#111'; ctx.fillRect(5, -15 - this.height - 5, this.width - 10, 5);
                    ctx.fillStyle = '#333'; ctx.fillRect(this.width/2 - 10, -15 - this.height - 10, 20, 5);
                    ctx.fillStyle = '#000'; ctx.fillRect(this.width, -25, 20, 8);
                    ctx.restore();
                }
            }

            class ShayLocomotive {
                constructor() {
                    this.x = w * 0.5; this.y = h * CONFIG.groundY;
                    this.wheelRot = 0; this.steamParticles = [];
                    this.carriages = [ new Carriage(-180), new Carriage(-360), new Carriage(-540) ];
                }
                update() {
                    this.bump = Math.sin(time * 0.8) * 1.2;
                    this.drawY = this.y + this.bump;
                    this.wheelRot += 0.15 * CONFIG.speed;
                    if (frame % 3 === 0) { this.steamParticles.push(new Steam(this.x + 130, this.drawY - 95, -CONFIG.speed * 2)); }
                    for (let i = this.steamParticles.length - 1; i >= 0; i--) { let s = this.steamParticles[i]; s.update(); if (s.life <= 0) this.steamParticles.splice(i, 1); }
                }
                draw() {
                    this.steamParticles.forEach(s => s.draw());
                    for(let i = this.carriages.length - 1; i >= 0; i--) { this.carriages[i].draw(this.x, this.drawY, this.wheelRot); }
                    ctx.save(); ctx.translate(this.x, this.drawY);
                    ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.filter = 'blur(10px)'; ctx.fillRect(-10, -5, 320, 20); ctx.filter = 'none';
                    const drawWheel = (wx, rot) => {
                        ctx.save(); ctx.translate(wx, -15); ctx.rotate(rot);
                        ctx.fillStyle = '#111'; ctx.beginPath(); ctx.arc(0, 0, 18, 0, TWO_PI); ctx.fill();
                        ctx.strokeStyle = '#555'; ctx.lineWidth = 2; ctx.stroke();
                        ctx.strokeStyle = '#333'; ctx.lineWidth = 2; for(let i=0; i<3; i++) { ctx.rotate(PI*2/3); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(18,0); ctx.stroke(); }
                        ctx.restore(); ctx.fillStyle = '#222'; ctx.fillRect(wx - 8, -15 - 8, 16, 16);
                    };
                    drawWheel(30, this.wheelRot); drawWheel(75, this.wheelRot); drawWheel(220, this.wheelRot); drawWheel(265, this.wheelRot);
                    ctx.strokeStyle = '#888'; ctx.lineWidth = 6; ctx.lineCap = 'round'; let shaftOffset = Math.sin(this.wheelRot) * 5; ctx.beginPath(); ctx.moveTo(30, -15 + shaftOffset); ctx.lineTo(265, -15 + shaftOffset); ctx.stroke();
                    ctx.fillStyle = '#1a1a1a'; ctx.fillRect(190, -70, 30, 50); ctx.fillStyle = CONFIG.color.alishanRed; ctx.fillRect(195, -65, 20, 40); let pistonY = Math.sin(this.wheelRot) * 10; ctx.fillStyle = '#AAA'; ctx.fillRect(202, -25, 6, 25 + pistonY);
                    const ar = CONFIG.color.alishanRed;
                    ctx.fillStyle = ar; ctx.fillRect(0, -90, 100, 75); ctx.fillStyle = '#000'; ctx.fillRect(-5, -95, 110, 10); ctx.fillStyle = '#2C3E50'; ctx.fillRect(10, -75, 30, 30); ctx.fillRect(50, -75, 30, 30);
                    ctx.fillStyle = ar; ctx.fillRect(-60, -60, 60, 45); ctx.fillStyle = CONFIG.color.alishanYellow; ctx.fillRect(-60, -30, 60, 5);
                    ctx.fillStyle = '#222'; ctx.beginPath(); ctx.rect(100, -70, 180, 55); ctx.fill(); ctx.fillStyle = ar; ctx.fillRect(100, -45, 180, 5);
                    ctx.fillStyle = '#111'; ctx.beginPath(); ctx.moveTo(250, -70); ctx.lineTo(245, -110); ctx.lineTo(265, -110); ctx.lineTo(260, -70); ctx.fill();
                    ctx.fillStyle = ar; ctx.fillRect(243, -115, 24, 5);
                    ctx.fillStyle = '#333'; ctx.beginPath(); ctx.arc(150, -70, 12, PI, 0); ctx.fill(); ctx.beginPath(); ctx.arc(180, -70, 12, PI, 0); ctx.fill();
                    ctx.fillStyle = '#Bfa384'; ctx.beginPath(); ctx.arc(280, -42, 10, 0, TWO_PI); ctx.fill(); ctx.fillStyle = '#000'; ctx.font = 'bold 8px Arial'; ctx.fillText('28', 274, -40);
                    ctx.fillStyle = '#111'; ctx.beginPath(); ctx.moveTo(280, -15); ctx.lineTo(310, -5); ctx.lineTo(280, -5); ctx.fill();
                    ctx.fillStyle = '#FFF'; ctx.beginPath(); ctx.arc(275, -90, 8, 0, TWO_PI); ctx.fill(); ctx.globalCompositeOperation = 'screen'; let grad = ctx.createRadialGradient(275, -90, 5, 275, -90, 60); grad.addColorStop(0, 'rgba(255, 255, 200, 0.8)'); grad.addColorStop(1, 'rgba(255, 255, 200, 0)'); ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(275, -90, 60, 0, TWO_PI); ctx.fill(); ctx.globalCompositeOperation = 'source-over';
                    ctx.restore();
                }
            }

            class Landscape {
                constructor() {
                    this.layers = [
                        { color: CONFIG.color.mountains[0], y: 0.35, amp: 150, speed: 0.1 },
                        { color: CONFIG.color.mountains[1], y: 0.45, amp: 100, speed: 0.2 },
                        { color: CONFIG.color.mountains[2], y: 0.55, amp: 60,  speed: 0.4 },
                        { color: CONFIG.color.mountains[3], y: 0.65, amp: 40,  speed: 0.8 }
                    ];
                }
                draw(limitY) {
                    this.layers.forEach((layer, index) => {
                        ctx.fillStyle = layer.color;
                        ctx.beginPath(); ctx.moveTo(0, limitY); 
                        let offset = time * layer.speed * CONFIG.speed;
                        for (let x = 0; x <= w; x += 5) {
                            let nx = (x + offset * 100) * 0.003;
                            let hOffset = noise(nx, index * 100) * layer.amp;
                            ctx.lineTo(x, h * layer.y - hOffset);
                        }
                        ctx.lineTo(w, limitY); ctx.fill();
                        if (index < 3) { ctx.fillStyle = `rgba(180, 150, 150, ${0.1 - index * 0.02})`; ctx.fill(); }
                    });
                }
            }

            class Foreground {
                constructor() {
                    this.trees = [];
                    for(let i=0; i<6; i++) this.trees.push({ x: random(0, w) });
                }
                draw(limitY) {
                    let speed = CONFIG.speed * 8;
                    ctx.fillStyle = '#05070a';
                    this.trees.forEach((t) => {
                        t.x -= speed; if(t.x < -200) t.x = w + random(0, 500);
                        ctx.save(); ctx.translate(t.x, limitY); 
                        ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(20, -h*0.4); ctx.lineTo(50, 0); ctx.fill();
                        ctx.beginPath(); ctx.arc(20, -h*0.4, 60, 0, TWO_PI); ctx.arc(-20, -h*0.3, 50, 0, TWO_PI); ctx.arc(50, -h*0.35, 55, 0, TWO_PI); ctx.fill();
                        ctx.restore();
                    });
                }
            }

            function drawSky(limitY) {
                let grd = ctx.createLinearGradient(0, 0, 0, limitY);
                grd.addColorStop(0, CONFIG.color.skyTop); grd.addColorStop(0.6, '#3E2028'); grd.addColorStop(1, CONFIG.color.skyHori);
                ctx.fillStyle = grd; ctx.fillRect(0, 0, w, limitY);

                let sunX = w * 0.65; 
                let sunY = h * 0.18; 
                
                ctx.save();
                ctx.fillStyle = CONFIG.color.sun; ctx.shadowBlur = 50; ctx.shadowColor = CONFIG.color.sun;
                ctx.beginPath(); ctx.arc(sunX, sunY, 40, 0, TWO_PI); ctx.fill(); ctx.shadowBlur = 0;
                let glow = ctx.createRadialGradient(sunX, sunY, 40, sunX, sunY, 400);
                glow.addColorStop(0, 'rgba(242, 201, 76, 0.4)'); glow.addColorStop(0.5, 'rgba(196, 77, 86, 0.2)'); glow.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = glow; ctx.globalCompositeOperation = 'screen';
                ctx.beginPath(); ctx.arc(sunX, sunY, 400, 0, TWO_PI); ctx.fill();
                ctx.globalCompositeOperation = 'source-over'; ctx.restore();
            }

            function applyFilters(limitY) {
                let grad = ctx.createRadialGradient(w/2, limitY/2, w*0.3, w/2, limitY/2, w*0.8);
                grad.addColorStop(0, 'rgba(0,0,0,0)'); grad.addColorStop(1, 'rgba(0,0,0,0.6)');
                ctx.fillStyle = grad; ctx.fillRect(0,0,w,limitY);
            }

            // 優化後的融合濾鏡：只作用在最底部，避免把樹切斷
            function applyBottomFade(limitY) {
                // 漸層高度：只佔畫面的 20%
                let fadeHeight = h * 0.2; 
                let fadeStart = h - fadeHeight; 

                // 為了安全起見，如果 limitY 比較高（螢幕很寬的時候），我們確保漸層至少蓋住 limitY
                // 但為了自然感，主要還是靠底部漸層
                
                let fadeGrad = ctx.createLinearGradient(0, fadeStart, 0, h);
                // 使用米黃色 #F9F7F2 (249, 247, 242)
                fadeGrad.addColorStop(0, 'rgba(249, 247, 242, 0)');   
                fadeGrad.addColorStop(0.6, 'rgba(249, 247, 242, 0.8)'); 
                fadeGrad.addColorStop(1, 'rgba(249, 247, 242, 1)');      

                ctx.fillStyle = fadeGrad;
                ctx.fillRect(0, fadeStart, w, fadeHeight);
            }

            let landscape, fullTrain, sakuras, foreground;
            let borderY; 

            function init() {
                w = canvas.width = container.offsetWidth;
                h = canvas.height = container.offsetHeight;
                borderY = h * (1 - CONFIG.whiteSpaceH); 
                
                landscape = new Landscape();
                fullTrain = new ShayLocomotive();
                sakuras = Array.from({length: CONFIG.sakuraCount}, () => new Sakura());
                foreground = new Foreground();
            }

            function render() {
                ctx.clearRect(0, 0, w, h);
                time += 0.05; frame++;
                
                drawSky(borderY);
                landscape.draw(borderY);
                fullTrain.update(); 
                fullTrain.draw();   
                sakuras.forEach(s => { s.update(); s.draw(); });
                
                ctx.filter = 'blur(3px)'; foreground.draw(borderY); ctx.filter = 'none';
                
                applyFilters(borderY);
                applyBottomFade(borderY);

                requestAnimationFrame(render);
            }

            window.addEventListener('resize', init);
            init();
            render();
        })();

        // ----------------------------------------------------
        // Part B: 報告功能邏輯
        // ----------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Timelapse
            const tlContainer = document.getElementById('tl-imageContainer');
            const tlSlider = document.getElementById('tl-slider');
            const tlPlayBtn = document.getElementById('tl-playBtn');
            const tlCurrentIdxDisplay = document.getElementById('tl-currentIdx');
            const tlLoadingText = document.getElementById('tl-loadingText');

            const config = {
                folder: 'TimeMap',  
                total: 49,          
                ext: '.png',        
                speed: 150          
            };

            let tlImages = [];
            let isPlaying = false;
            let playInterval = null;

            function initTimelapse() {
                let loadedCount = 0;
                for (let i = 0; i < config.total; i++) {
                    const numStr = String(i).padStart(4, '0');
                    const path = `${config.folder}/${numStr}${config.ext}`;
                    const img = document.createElement('img');
                    img.src = path;
                    img.alt = `Time Point ${numStr}`;
                    img.classList.add('tl-frame');
                    if (i === 0) img.classList.add('active');
                    img.onload = () => {
                        loadedCount++;
                        if (loadedCount === config.total) {
                            if(tlLoadingText) tlLoadingText.style.display = 'none';
                        }
                    };
                    img.onerror = () => { console.warn(`找不到圖片: ${path}`); }
                    if(tlContainer) tlContainer.appendChild(img);
                    tlImages.push(img);
                }
            }

            function updateFrame(index) {
                const currentActive = tlContainer.querySelector('.active');
                if (currentActive) currentActive.classList.remove('active');
                if (tlImages[index]) {
                    tlImages[index].classList.add('active');
                    tlCurrentIdxDisplay.textContent = String(index).padStart(4, '0');
                }
            }

            function togglePlay() {
                if (isPlaying) {
                    clearInterval(playInterval);
                    tlPlayBtn.innerHTML = '<span>▶ 播放</span>';
                    isPlaying = false;
                } else {
                    tlPlayBtn.innerHTML = '<span>❚❚ 暫停</span>';
                    isPlaying = true;
                    playInterval = setInterval(() => {
                        let nextVal = parseInt(tlSlider.value) + 1;
                        if (nextVal >= config.total) nextVal = 0;
                        tlSlider.value = nextVal;
                        updateFrame(nextVal);
                    }, config.speed);
                }
            }

            if(tlSlider) {
                tlSlider.addEventListener('input', (e) => {
                    if (isPlaying) togglePlay();
                    updateFrame(parseInt(e.target.value));
                });
            }
            if(tlPlayBtn) tlPlayBtn.addEventListener('click', togglePlay);
            if(tlContainer) initTimelapse();

            // 2. UI
            const progressBar = document.getElementById('progress-bar');
            window.addEventListener('scroll', () => {
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrollPercent = (scrollTop / scrollHeight) * 100;
                if(progressBar) progressBar.style.width = scrollPercent + '%';
            });

            const backToTopBtn = document.getElementById('back-to-top');
            const checkScrollPosition = () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.remove('opacity-0');
                    backToTopBtn.setAttribute('tabindex', '0'); 
                    backToTopBtn.classList.remove('hidden'); 
                } else {
                    backToTopBtn.classList.add('opacity-0');
                    backToTopBtn.setAttribute('tabindex', '-1');
                }
            };
            if(backToTopBtn) {
                backToTopBtn.setAttribute('tabindex', '-1'); 
                window.addEventListener('scroll', checkScrollPosition);
                window.addEventListener('load', checkScrollPosition); 
                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const closeBtn = document.getElementById('lightbox-close');
            const contentImages = document.querySelectorAll('main figure img');

            const openLightbox = (src, alt) => {
                lightboxImg.src = src;
                lightboxCaption.textContent = alt;
                lightbox.classList.remove('hidden');
                requestAnimationFrame(() => { lightbox.classList.remove('opacity-0'); });
                document.body.style.overflow = 'hidden'; closeBtn.focus(); 
            };
            const closeLightbox = () => {
                lightbox.classList.add('opacity-0');
                setTimeout(() => { lightbox.classList.add('hidden'); lightboxImg.src = ''; }, 300); 
                document.body.style.overflow = '';
            };

            contentImages.forEach(img => {
                const figure = img.closest('figure');
                if(!figure) return; 
                figure.addEventListener('click', (e) => { e.stopPropagation(); openLightbox(img.src, img.alt); });
                figure.setAttribute('tabindex', '0'); figure.setAttribute('role', 'button');
                figure.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openLightbox(img.src, img.alt); }
                });
            });

            if(closeBtn) closeBtn.addEventListener('click', closeLightbox);
            if(lightbox) {
                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox && e.target !== lightboxImg) { closeLightbox(); }
                });
            }
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && lightbox && !lightbox.classList.contains('hidden')) { closeLightbox(); }
            });
        });
    </script>
</body>
</html>
