<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åºåˆ—é»æ“Šè³“æœ</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e67e22;
            --delete: #e74c3c;
            --bg: #f5f6fa;
            --text: #2f3640;
            --radius: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--secondary); }
        
        .container {
            width: 100%;
            max-width: 480px;
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            margin-top: 15px;
            text-align: center;
        }

        .hidden { display: none !important; }

        /* STATUS BAR */
        .status-bar {
            background: var(--secondary);
            color: white;
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .next-indicator { font-size: 1.2rem; font-weight: bold; }
        .next-number { 
            color: var(--accent); font-size: 1.5rem; background: white; 
            padding: 2px 10px; border-radius: 6px; margin-left: 5px;
        }

        /* GRID */
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .cell {
            aspect-ratio: 1;
            background: #ecf0f1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--secondary);
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Filling Mode Styles */
        .cell.filled {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        .cell:active { transform: scale(0.95); }

        /* Game Mode Styles */
        .cell.game-mode { cursor: pointer; }
        .cell.game-mode.marked {
            background: var(--delete);
            color: white;
            border-color: var(--delete);
        }
        .cell.game-mode.marked::after {
            content: 'âœ•'; font-size: 2rem; position: absolute; opacity: 0.6;
        }

        /* BUTTONS */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: opacity 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-outline { background: transparent; border: 2px solid #bdc3c7; color: #7f8c8d; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Setup Inputs */
        .input-group { margin-bottom: 20px; text-align: left; }
        input[type="number"] {
            width: 100%; padding: 12px; font-size: 1.2rem; 
            text-align: center; border: 2px solid #ddd; border-radius: 8px;
        }

        /* Instruction text */
        .instruction {
            font-size: 0.9rem; color: #7f8c8d; margin-top: 5px;
        }
    </style>
</head>
<body>

    <h1>Bingo Sequence</h1>

    <div id="setup-panel" class="container">
        <h2>éŠæˆ²è¨­å®š</h2>
        <div class="input-group">
            <label>æœ€å¤§æ•¸å­— (Max Number)</label>
            <input type="number" id="max-num" value="50">
        </div>
        <button class="btn btn-primary" onclick="initSelection()">é–‹å§‹å¡«å¯«å¡ç‰‡</button>
        <p class="instruction">è¨­å®šç¯„åœå¾Œï¼Œé€²å…¥å¡«å¯«æ¨¡å¼ã€‚</p>
    </div>

    <div id="selection-panel" class="container hidden">
        <div class="status-bar">
            <span>å¡«å¯«é€²åº¦: <span id="progress">0/25</span></span>
            <div class="next-indicator">ä¸‹ä¸€è™Ÿ: <span id="next-num-display" class="next-number">1</span></div>
        </div>

        <div class="bingo-grid" id="select-grid">
            </div>

        <p class="instruction">ğŸ‘† å–®æ“Šå¡«å…¥æ•¸å­—ï¼ŒâœŒï¸ é€£æŒ‰å…©ä¸‹åˆªé™¤</p>
        
        <div style="margin-top: 20px;">
            <button class="btn btn-outline" onclick="autoFillRemaining()">âœ¨ å‰©ä¸‹çš„éš¨æ©Ÿè£œæ»¿</button>
            <button id="start-btn" class="btn btn-success" onclick="startGame()" disabled>ğŸ”’ é–å®šä¸¦é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <div id="game-panel" class="container hidden">
        <div class="status-bar" style="justify-content: center;">
            <span style="font-size: 1.2rem;">ğŸ® éŠæˆ²é€²è¡Œä¸­</span>
        </div>
        
        <div class="bingo-grid" id="game-grid">
            </div>

        <button class="btn btn-outline" onclick="if(confirm('è¦é‡æ–°é–‹å§‹å—ï¼Ÿ')) location.reload()">é€€å‡ºéŠæˆ²</button>
    </div>

    <script>
        let maxNumber = 50;
        let cardData = new Array(25).fill(null);
        let clickTimer = null;
        let lastClickIndex = -1;

        // --- SETUP ---
        function initSelection() {
            const val = parseInt(document.getElementById('max-num').value);
            if (val < 25) { alert("æ•¸å­—å¤ªå°‘ç„¡æ³•å¡«æ»¿å¡ç‰‡ï¼è‡³å°‘ 25ã€‚"); return; }
            maxNumber = val;
            
            document.getElementById('setup-panel').classList.add('hidden');
            document.getElementById('selection-panel').classList.remove('hidden');
            renderSelectionGrid();
            updateNextNumber();
        }

        // --- CORE LOGIC: NEXT NUMBER ---
        function getNextAvailableNumber() {
            // Find the smallest number starting from 1 that is NOT in cardData
            for (let i = 1; i <= maxNumber; i++) {
                if (!cardData.includes(i)) {
                    return i;
                }
            }
            return null; // Full or logic error
        }

        function updateNextNumber() {
            const next = getNextAvailableNumber();
            const display = document.getElementById('next-num-display');
            const startBtn = document.getElementById('start-btn');
            const progress = document.getElementById('progress');

            // Update Progress
            const count = cardData.filter(n => n !== null).length;
            progress.innerText = `${count}/25`;

            if (next === null || count === 25) {
                display.innerText = "å®Œæˆ";
                display.style.color = "#27ae60";
                startBtn.disabled = false;
                startBtn.style.opacity = "1";
            } else {
                display.innerText = next;
                display.style.color = "#e67e22";
                startBtn.disabled = true;
                startBtn.style.opacity = "0.5";
            }
        }

        // --- INTERACTION ---
        function handleCellClick(index) {
            const now = new Date().getTime();
            
            // Logic for Double Click detection
            if (lastClickIndex === index && (now - clickTimer) < 300) {
                // Double Click Detected -> DELETE
                deleteNumber(index);
                lastClickIndex = -1; // Reset
            } else {
                // Single Click Detected (Wait slightly to ensure it's not a double click? 
                // No, for responsiveness we execute immediately. Double click will just override.)
                
                // If cell is empty, fill it
                if (cardData[index] === null) {
                    fillNumber(index);
                } 
                // If cell is full, single click does nothing (waiting for potential double click)
                
                clickTimer = now;
                lastClickIndex = index;
            }
        }

        function fillNumber(index) {
            const next = getNextAvailableNumber();
            if (next === null) return; // Full

            cardData[index] = next;
            
            // Visual Update
            updateCellVisual(index);
            updateNextNumber();
        }

        function deleteNumber(index) {
            if (cardData[index] === null) return;
            
            cardData[index] = null;
            
            // Visual Update
            updateCellVisual(index);
            updateNextNumber();
        }

        function updateCellVisual(index) {
            const cell = document.getElementById(`cell-${index}`);
            const val = cardData[index];
            
            if (val !== null) {
                cell.innerText = val;
                cell.classList.add('filled');
            } else {
                cell.innerText = '';
                cell.classList.remove('filled');
            }
        }

        function renderSelectionGrid() {
            const grid = document.getElementById('select-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                
                // Custom Click Handler for Double Tap support
                cell.addEventListener('click', () => handleCellClick(i));
                
                grid.appendChild(cell);
            }
        }

        function autoFillRemaining() {
            // Find all available numbers
            let available = [];
            for (let i = 1; i <= maxNumber; i++) {
                if (!cardData.includes(i)) available.push(i);
            }

            // Shuffle
            for (let i = available.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [available[i], available[j]] = [available[j], available[i]];
            }

            // Fill empty slots
            let ptr = 0;
            for (let i = 0; i < 25; i++) {
                if (cardData[i] === null && ptr < available.length) {
                    cardData[i] = available[ptr++];
                    updateCellVisual(i);
                }
            }
            updateNextNumber();
        }

        // --- GAME MODE ---
        function startGame() {
            if (!confirm("ç¢ºå®šé–å®šå¡ç‰‡ä¸¦é–‹å§‹éŠæˆ²å—ï¼Ÿ")) return;

            document.getElementById('selection-panel').classList.add('hidden');
            document.getElementById('game-panel').classList.remove('hidden');

            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';

            cardData.forEach(num => {
                const cell = document.createElement('div');
                cell.className = 'cell game-mode filled'; // Use filled style
                cell.innerText = num;
                cell.onclick = function() {
                    this.classList.toggle('marked');
                };
                grid.appendChild(cell);
            });
        }
    </script>
</body>
</html>
