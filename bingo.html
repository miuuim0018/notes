<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥µé€Ÿé»é¸è³“æœ (Speed Bingo)</title>
    <style>
        :root {
            --primary: #2980b9;
            --secondary: #34495e;
            --accent: #27ae60;
            --highlight: #f39c12;
            --delete: #c0392b;
            --bg: #ecf0f1;
            --text: #2c3e50;
            --cell-base: #fff;
            --radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin: 0 0 10px 0; color: var(--secondary); text-align: center; font-size: 1.5rem; }
        p { margin: 5px 0 20px 0; color: #7f8c8d; font-size: 0.9rem; text-align: center; }

        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .hidden { display: none !important; }

        /* BUTTONS */
        .btn {
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: opacity 0.2s;
            margin-bottom: 10px;
        }
        .btn:active { transform: translateY(2px); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-host { background: var(--secondary); color: white; }
        .btn-start { background: var(--accent); color: white; box-shadow: 0 4px 0 #1e8449; }
        .btn-danger { background: var(--delete); color: white; }
        .btn-outline { background: transparent; border: 2px solid #bdc3c7; color: #7f8c8d; }

        /* SETUP SCREEN */
        .setup-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="number"] {
            width: 100%; padding: 12px; border: 2px solid #ddd;
            border-radius: var(--radius); font-size: 1.2rem; text-align: center;
        }

        /* BINGO CARD GRID (5x5) */
        .card-area { margin-bottom: 20px; }
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            background: var(--secondary);
            padding: 8px;
            border-radius: var(--radius);
            margin: 0 auto;
            aspect-ratio: 1; /* Keep square */
        }

        .cell {
            background: var(--cell-base);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        /* Empty state styling */
        .cell.empty { background: #e0e0e0; color: #aaa; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
        
        /* Filled state styling (Pre-game) */
        .cell.filled { background: #fff; color: var(--primary); border: 2px solid var(--primary); }

        /* Game Active State styling */
        .cell.game-mode:active { background: #ddd; }
        .cell.marked { background: var(--delete); color: white; }
        .cell.marked::after { content: 'âœ•'; font-size: 2rem; position: absolute; opacity: 0.8; }

        /* KEYBOARD POOL AREA */
        .pool-area {
            border-top: 2px solid #eee;
            padding-top: 15px;
        }
        .pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .pool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
        }

        .pool-btn {
            background: white;
            border: 1px solid #bdc3c7;
            padding: 10px 0;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
        }
        .pool-btn.used {
            background: #ecf0f1;
            color: #bdc3c7;
            border-color: #ecf0f1;
            cursor: not-allowed;
            pointer-events: none;
        }
        .pool-btn:active { background: var(--primary); color: white; }

        /* ACTION BAR */
        .action-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        .btn-icon { font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }

        /* HOST STYLES */
        .host-display {
            font-size: 5rem; font-weight: 800; color: var(--highlight);
            text-align: center; padding: 30px; background: #fff;
            border: 4px dashed var(--secondary); border-radius: var(--radius);
            margin-bottom: 20px;
        }
        .history-grid {
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px;
        }
        .history-dot {
            aspect-ratio: 1; background: #ddd; color: #999;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; border-radius: 2px;
        }
        .history-dot.active { background: var(--secondary); color: white; font-weight: bold; }

    </style>
</head>
<body>

    <h1>Speed Bingo ğŸš€</h1>

    <div id="setup-screen" class="container">
        <h2>éŠæˆ²è¨­å®š</h2>
        <div class="setup-group">
            <label>æœ€å¤§æ•¸å­— (Max Number)</label>
            <input type="number" id="max-num-input" value="50" min="25" max="99">
            <small style="color:#e74c3c; display:block; margin-top:5px;">* å»ºè­°: è‡³å°‘ 25ï¼Œé€šå¸¸ç© 50 æˆ– 75</small>
        </div>
        <div class="setup-group">
            <button class="btn btn-primary" onclick="goToPlayerSetup()">æˆ‘æ˜¯ç©å®¶ (é–‹å§‹é¸è™Ÿ)</button>
            <button class="btn btn-host" onclick="goToHost()">æˆ‘æ˜¯ä¸»æŒäºº (è² è²¬é–‹ç)</button>
        </div>
    </div>

    <div id="selection-screen" class="container hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">å¡«å¯«æ‚¨çš„å¡ç‰‡</h3>
            <span id="progress-text" style="font-weight:bold; color:var(--primary);">0 / 25</span>
        </div>

        <div class="card-area">
            <div class="bingo-grid" id="selection-grid">
                </div>
        </div>

        <div class="action-bar">
            <button class="btn btn-outline btn-icon" onclick="randomFill()">ğŸ² éš¨æ©Ÿ</button>
            <button class="btn btn-outline btn-icon" onclick="backspace()">âŒ« åˆªé™¤</button>
            <button class="btn btn-outline btn-icon" onclick="resetSelection()">â†» é‡ç½®</button>
        </div>

        <div class="pool-area">
            <div class="pool-header">
                <span style="font-size:0.9rem; color:#666;">é»æ“Šä¸‹æ–¹æ•¸å­—å¡«å…¥ç©ºæ ¼:</span>
            </div>
            <div class="pool-grid" id="number-pool">
                </div>
        </div>

        <button id="lock-btn" class="btn btn-start" style="margin-top:15px; opacity: 0.5; pointer-events: none;" onclick="startGame()">
            ğŸ”’ é–å®šä¸¦é–‹å§‹éŠæˆ²
        </button>
    </div>

    <div id="game-screen" class="container hidden">
        <h2>Bingo Card</h2>
        <p>é»æ“Šæ ¼å­æ¨™è¨˜è™Ÿç¢¼ã€‚é€£æˆ 5 æ¢ç·šå°±è´äº†ï¼</p>
        
        <div class="card-area">
            <div class="bingo-grid" id="game-grid">
                </div>
        </div>
        
        <button class="btn btn-danger" onclick="if(confirm('ç¢ºå®šè¦é›¢é–‹å—ï¼Ÿå¡ç‰‡æœƒæ¶ˆå¤±å–”ï¼')) location.reload()">é€€å‡ºéŠæˆ²</button>
    </div>

    <div id="host-screen" class="container hidden">
        <h2>ä¸»æŒäººé–‹çå°</h2>
        <div class="host-display" id="host-number">READY</div>
        
        <button class="btn btn-primary" style="font-size:1.5rem; padding: 20px;" onclick="drawNumber()">æŠ½å‡ºè™Ÿç¢¼ï¼</button>
        
        <div style="margin-top:20px;">
            <p>æ­·å²ç´€éŒ„ (1-<span id="host-max-display"></span>)</p>
            <div class="history-grid" id="host-history"></div>
        </div>
        
        <button class="btn btn-outline" style="margin-top:30px;" onclick="if(confirm('é‡ç½®å°‡æ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Œç¢ºå®šå—ï¼Ÿ')) location.reload()">çµæŸä¸¦é‡ç½®</button>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let maxNumber = 50;
        let cardData = new Array(25).fill(null); // Stores the user's selected numbers
        let gameLocked = false;

        // --- NAVIGATION ---
        function goToPlayerSetup() {
            if (!validateSetup()) return;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('selection-screen').classList.remove('hidden');
            renderSelectionGrid();
            renderNumberPool();
        }

        function goToHost() {
            if (!validateSetup()) return;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('host-screen').classList.remove('hidden');
            initHostBoard();
        }

        function validateSetup() {
            const input = document.getElementById('max-num-input');
            const val = parseInt(input.value);
            if (val < 25 || isNaN(val)) {
                alert("æœ€å¤§æ•¸å­—è‡³å°‘éœ€è¦ 25 å–”ï¼ä¸ç„¶æ ¼å­å¡«ä¸æ»¿ã€‚");
                return false;
            }
            maxNumber = val;
            return true;
        }

        // --- PLAYER: SELECTION LOGIC ---

        function renderSelectionGrid() {
            const grid = document.getElementById('selection-grid');
            grid.innerHTML = '';
            
            cardData.forEach((num, index) => {
                const cell = document.createElement('div');
                cell.className = num ? 'cell filled' : 'cell empty';
                cell.innerText = num || (index + 1); // Show small index hint if empty
                cell.style.color = num ? 'var(--primary)' : '#ccc';
                cell.style.fontSize = num ? '1.2rem' : '0.8rem';
                
                // Click to delete functionality
                cell.onclick = () => {
                    if (num !== null) {
                        removeNumberAtIndex(index);
                    }
                };
                
                grid.appendChild(cell);
            });
            updateProgress();
        }

        function renderNumberPool() {
            const pool = document.getElementById('number-pool');
            pool.innerHTML = '';

            for (let i = 1; i <= maxNumber; i++) {
                const btn = document.createElement('button');
                btn.className = 'pool-btn';
                btn.innerText = i;
                
                // If number is already in card, disable it
                if (cardData.includes(i)) {
                    btn.classList.add('used');
                }

                btn.onclick = () => selectNumber(i);
                pool.appendChild(btn);
            }
        }

        function selectNumber(num) {
            // Find first empty slot
            const emptyIndex = cardData.indexOf(null);
            if (emptyIndex === -1) {
                // Card is full
                return; 
            }

            cardData[emptyIndex] = num;
            playSound('pop');
            updateUI();
        }

        function removeNumberAtIndex(index) {
            cardData[index] = null;
            playSound('click');
            updateUI();
        }

        function backspace() {
            // Find the last filled slot (reverse search)
            for (let i = 24; i >= 0; i--) {
                if (cardData[i] !== null) {
                    cardData[i] = null;
                    playSound('click');
                    updateUI();
                    return;
                }
            }
        }

        function randomFill() {
            // Create a pool of available numbers (numbers NOT currently in cardData)
            const available = [];
            for (let i = 1; i <= maxNumber; i++) {
                if (!cardData.includes(i)) {
                    available.push(i);
                }
            }

            // Shuffle available
            for (let i = available.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [available[i], available[j]] = [available[j], available[i]];
            }

            // Fill empty slots
            let textIndex = 0;
            for (let i = 0; i < 25; i++) {
                if (cardData[i] === null) {
                    if (textIndex < available.length) {
                        cardData[i] = available[textIndex++];
                    }
                }
            }
            updateUI();
        }

        function resetSelection() {
            if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ•¸å­—å—ï¼Ÿ')) {
                cardData.fill(null);
                updateUI();
            }
        }

        function updateUI() {
            renderSelectionGrid();
            renderNumberPool(); // Re-render pool to update "used" status
            
            // Check if full to enable Lock button
            const isFull = !cardData.includes(null);
            const lockBtn = document.getElementById('lock-btn');
            
            if (isFull) {
                lockBtn.style.opacity = '1';
                lockBtn.style.pointerEvents = 'auto';
                lockBtn.innerText = "ğŸ”’ é–å®šä¸¦é–‹å§‹éŠæˆ²";
            } else {
                lockBtn.style.opacity = '0.5';
                lockBtn.style.pointerEvents = 'none';
                lockBtn.innerText = "è«‹å¡«æ»¿ 25 å€‹æ•¸å­—";
            }
        }

        function updateProgress() {
            const count = cardData.filter(n => n !== null).length;
            document.getElementById('progress-text').innerText = `${count} / 25`;
        }

        // --- PLAYER: GAME LOGIC ---

        function startGame() {
            if (!confirm("é–å®šå¾Œå°±ä¸èƒ½ä¿®æ”¹æ•¸å­—å›‰ï¼Œç¢ºå®šé–‹å§‹å—ï¼Ÿ")) return;
            
            document.getElementById('selection-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';

            cardData.forEach(num => {
                const cell = document.createElement('div');
                cell.className = 'cell game-mode';
                cell.innerText = num;
                cell.onclick = function() {
                    this.classList.toggle('marked');
                    playSound('mark');
                };
                grid.appendChild(cell);
            });
        }

        // --- HOST LOGIC ---
        let hostDrawn = [];
        let isAnimating = false;

        function initHostBoard() {
            document.getElementById('host-max-display').innerText = maxNumber;
            const board = document.getElementById('host-history');
            board.innerHTML = '';
            // Responsive grid columns
            const cols = Math.ceil(Math.sqrt(maxNumber));
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for(let i=1; i<=maxNumber; i++){
                const dot = document.createElement('div');
                dot.className = 'history-dot';
                dot.id = `h-${i}`;
                dot.innerText = i;
                board.appendChild(dot);
            }
        }

        function drawNumber() {
            if (isAnimating) return;
            if (hostDrawn.length >= maxNumber) {
                alert("è™Ÿç¢¼å…¨éƒ¨æŠ½å®Œå•¦ï¼");
                return;
            }

            isAnimating = true;
            const display = document.getElementById('host-number');
            let counter = 0;
            
            // Animation loop
            const timer = setInterval(() => {
                display.innerText = Math.floor(Math.random() * maxNumber) + 1;
                counter++;
                if (counter > 10) {
                    clearInterval(timer);
                    finalizeHostDraw();
                }
            }, 60);
        }

        function finalizeHostDraw() {
            let num;
            do {
                num = Math.floor(Math.random() * maxNumber) + 1;
            } while (hostDrawn.includes(num));

            hostDrawn.push(num);
            document.getElementById('host-number').innerText = num;
            document.getElementById(`h-${num}`).classList.add('active');
            isAnimating = false;
        }

        // Optional: Simple sound feedback
        function playSound(type) {
            // Placeholder for sound effects if needed in future
            // const context = new AudioContext(); ...
        }

    </script>
</body>
</html>
