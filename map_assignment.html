<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°‘é›„æ‰‹æ–æ¯ä¸€ç´šæˆ°å€åœ°åœ–</title>
    
    <!-- 1. å¼•å…¥ Leaflet åœ°åœ–å¥—ä»¶ CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            overflow: hidden; /* é˜²æ­¢æ²è»¸å‡ºç¾ */
        }

        /* åœ°åœ–æ»¿ç‰ˆ */
        #map {
            height: 100%; 
            width: 100%;
            z-index: 1;
        }

        /* å·¦ä¸Šè§’æ¨™é¡Œå€å¡Š */
        .title-box {
            position: absolute;
            top: 20px;
            left: 60px; /* é¿é–‹ç¸®æ”¾æŒ‰éˆ• */
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border-left: 5px solid #FF9800; /* æ©˜è‰²è£é£¾ç·š */
        }

        .title-box h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #333;
        }

        .title-box p {
            margin: 5px 0 0 0;
            font-size: 0.9rem;
            color: #666;
        }

        /* å³ä¸‹è§’çµ±è¨ˆåœ–è¡¨å€å¡Š */
        .chart-panel {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 320px;
            max-height: 40vh;
        }

        .chart-panel h3 {
            margin-top: 0;
            font-size: 1.1rem;
            text-align: center;
            color: #444;
            margin-bottom: 10px;
        }

        /* è®“åœ–è¡¨åœ¨æ‰‹æ©Ÿä¸Šå¯ä»¥æ”¶åˆ (é¸ç”¨) */
        @media (max-width: 600px) {
            .chart-panel {
                width: 90%;
                right: 5%;
                bottom: 10px;
            }
            .title-box {
                left: 50px;
                right: 10px;
                top: 10px;
                padding: 10px;
            }
            .title-box h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <!-- æ¨™é¡Œ -->
    <div class="title-box">
        <h1>ğŸ¥¤ æ°‘é›„æ‰‹æ–æ¯æˆ°å€</h1>
        <p>æ°‘é›„å¸‚å€é£²æ–™åº—åˆ†ä½ˆèˆ‡å“ç‰Œå¸‚ä½”ç‡åˆ†æ</p>
    </div>

    <!-- çµ±è¨ˆåœ–è¡¨ -->
    <div class="chart-panel">
        <h3>å“ç‰Œæ•¸é‡çµ±è¨ˆ</h3>
        <canvas id="brandChart"></canvas>
    </div>

    <!-- åœ°åœ–æœ¬é«” -->
    <div id="map"></div>

    <!-- 2. å¼•å…¥ Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- 3. å¼•å…¥ Chart.js (åšåœ–è¡¨ç”¨çš„) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // --- è¨­å®šè³‡æ–™ï¼šæ°‘é›„æ‰‹æ–æ¯å‡è³‡æ–™ (æ¨¡æ“¬çœŸå¯¦åˆ†ä½ˆ) ---
        // ä½ å¯ä»¥è‡ªå·±åœ¨é€™è£¡æ–°å¢æˆ–ä¿®æ”¹åº§æ¨™
        const shopsData = [
            { name: "50åµ æ°‘é›„å»ºåœ‹åº—", brand: "50åµ", lat: 23.5532, lng: 120.4295, note: "æ’éšŠååº—" },
            { name: "50åµ æ°‘é›„é ­æ©‹åº—", brand: "50åµ", lat: 23.5410, lng: 120.4380, note: "å·¥æ¥­å€é™„è¿‘" },
            { name: "æ¸…å¿ƒç¦å…¨ æ°‘é›„ä¿ç”Ÿåº—", brand: "æ¸…å¿ƒç¦å…¨", lat: 23.5525, lng: 120.4305, note: "çƒé¾ç¶ å¥½å–" },
            { name: "æ¸…å¿ƒç¦å…¨ æ°‘é›„å»ºåœ‹åº—", brand: "æ¸…å¿ƒç¦å…¨", lat: 23.5550, lng: 120.4285, note: "" },
            { name: "éº»å¤èŒ¶åŠ æ°‘é›„åº—", brand: "éº»å¤èŒ¶åŠ", lat: 23.5528, lng: 120.4310, note: "èŠèŠç³»åˆ—" },
            { name: "å¯ä¸å¯ç†Ÿæˆç´…èŒ¶", brand: "å¯ä¸å¯", lat: 23.5518, lng: 120.4320, note: "è‹±å€«é¢¨è£æ½¢" },
            { name: "è¿·å®¢å¤ æ°‘é›„åº—", brand: "è¿·å®¢å¤", lat: 23.5522, lng: 120.4298, note: "ç‚ºäº†ç‰›å¥¶ä¾†çš„" },
            { name: "å¤§è‹‘å­ æ°‘é›„åº—", brand: "å¤§è‹‘å­", lat: 23.5535, lng: 120.4290, note: "æ°´æœèŒ¶å°ˆè³£" },
            { name: "èŒ¶æ¹¯æœƒ", brand: "èŒ¶æ¹¯æœƒ", lat: 23.5515, lng: 120.4325, note: "éµè§€éŸ³æ‹¿éµ" },
            { name: "é®®èŒ¶é“", brand: "å…¶ä»–å“ç‰Œ", lat: 23.5540, lng: 120.4280, note: "" },
            { name: "CoCoéƒ½å¯", brand: "å…¶ä»–å“ç‰Œ", lat: 23.5512, lng: 120.4330, note: "ç™¾é¦™é›™éŸ¿ç ²" },
            { name: "æ°‘é›„åœ¨åœ°ç´…èŒ¶å†°", brand: "åœ¨åœ°å°åº—", lat: 23.5505, lng: 120.4340, note: "ä¿—æ“±å¤§ç¢—" }
        ];

        // --- 1. åˆå§‹åŒ–åœ°åœ– ---
        // ä¸­å¿ƒé»è¨­åœ¨æ°‘é›„å¸‚å€ (ç´„åœ¨éµè‚‰è¡—/ç«è»Šç«™é™„è¿‘)
        const map = L.map('map').setView([23.5525, 120.4310], 15);

        // åº•åœ–ï¼šä½¿ç”¨ CartoDB çš„æ·ºè‰²åœ°åœ–ï¼Œè®“é£²æ–™åº—æ¨™è¨˜æ¯”è¼ƒæ˜é¡¯
        const lightMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Map data &copy; OpenStreetMap contributors',
            maxZoom: 20
        }).addTo(map);

        const osmMap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; OpenStreetMap contributors',
            maxZoom: 19
        });

        // --- 2. è™•ç†è³‡æ–™ä¸¦åŠ åˆ°åœ°åœ–ä¸Š ---
        
        // æº–å‚™ä¸€å€‹ç‰©ä»¶ä¾†å­˜æ”¾ä¸åŒå“ç‰Œçš„åœ–å±¤ç¾¤çµ„ (LayerGroup)
        const layers = {}; 
        
        // æº–å‚™çµ±è¨ˆæ•¸æ“š
        const brandCounts = {};

        // å®šç¾©ä¸€å€‹ helper å‡½æ•¸ä¾†æ±ºå®šæ¨™è¨˜é¡è‰² (ä½¿ç”¨ Leaflet é è¨­ iconï¼Œä½†ç”¨ filter è®Šè‰² - é€™è£¡ç°¡å–®ç”¨ popupå€åˆ†)
        shopsData.forEach(shop => {
            // 2.1 çµ±è¨ˆæ•¸é‡ (çµ¦åœ–è¡¨ç”¨)
            if (brandCounts[shop.brand]) {
                brandCounts[shop.brand]++;
            } else {
                brandCounts[shop.brand] = 1;
            }

            // 2.2 å»ºç«‹æ¨™è¨˜ (Marker)
            const marker = L.marker([shop.lat, shop.lng])
                .bindPopup(`<b>${shop.name}</b><br>å“ç‰Œ: ${shop.brand}<br>å‚™è¨»: ${shop.note}`);

            // 2.3 åˆ†é¡åœ–å±¤
            // å¦‚æœé€™å€‹å“ç‰Œçš„åœ–å±¤é‚„æ²’å»ºç«‹ï¼Œå°±é–‹ä¸€å€‹æ–°çš„
            if (!layers[shop.brand]) {
                layers[shop.brand] = L.layerGroup();
            }
            // æŠŠæ¨™è¨˜åŠ åˆ°å°æ‡‰å“ç‰Œçš„åœ–å±¤ä¸­
            layers[shop.brand].addLayer(marker);
        });

        // --- 3. åŠ å…¥åœ–å±¤æ§åˆ¶å™¨ ---
        
        // æŠŠåˆ†é¡å¥½çš„åœ–å±¤åŠ åˆ°åœ°åœ–ä¸Š (é è¨­å…¨é–‹)
        for (let brand in layers) {
            layers[brand].addTo(map);
        }

        const baseMaps = {
            "ç°¡æ½”æ·ºè‰²": lightMap,
            "æ¨™æº–è¡—æ™¯": osmMap
        };

        // å»ºç«‹åœ–å±¤æ§åˆ¶é …
        L.control.layers(baseMaps, layers, { collapsed: false }).addTo(map);


        // --- 4. ç¹ªè£½çµ±è¨ˆåœ–è¡¨ (Chart.js) ---
        const ctx = document.getElementById('brandChart').getContext('2d');
        
        // æ•´ç†åœ–è¡¨éœ€è¦çš„æ¨™ç±¤ (Labels) å’Œ æ•¸æ“š (Data)
        const chartLabels = Object.keys(brandCounts);
        const chartData = Object.values(brandCounts);

        // è¨­å®šåœ–è¡¨é¡è‰²
        const backgroundColors = [
            'rgba(255, 206, 86, 0.6)', // é»ƒ
            'rgba(75, 192, 192, 0.6)', // ç¶ 
            'rgba(255, 99, 132, 0.6)', // ç´…
            'rgba(54, 162, 235, 0.6)', // è—
            'rgba(153, 102, 255, 0.6)', // ç´«
            'rgba(255, 159, 64, 0.6)'  // æ©˜
        ];

        new Chart(ctx, {
            type: 'bar', // é•·æ¢åœ–
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'åº—å®¶æ•¸é‡',
                    data: chartData,
                    backgroundColor: backgroundColors,
                    borderColor: 'rgba(0,0,0,0.1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 } // è®“Yè»¸åªé¡¯ç¤ºæ•´æ•¸
                    }
                },
                plugins: {
                    legend: { display: false } // éš±è—åœ–ä¾‹ (åªæœ‰ä¸€çµ„æ•¸æ“šä¸éœ€è¦)
                }
            }
        });

    </script>
</body>
</html>
