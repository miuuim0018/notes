<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö°Ô∏è CHIAYI REGION DRINKS CYBER-MAP V4 ‚ö°Ô∏è</title>
    
    <!-- ÂºïÂÖ• Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #bc13fe;
            --neon-green: #0aff0a;
            --glass-bg: rgba(16, 20, 30, 0.85);
            --border-color: rgba(0, 243, 255, 0.3);
        }

        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0b0c10;
            color: #fff;
            overflow: hidden;
        }

        #map {
            height: 100vh; 
            width: 100%;
            z-index: 1;
            background: #0b0c10;
        }

        /* --- UI ÈÄöÁî®Ê®£Âºè (ÊØõÁéªÁíÉ) --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- 1. Â∑¶‰∏äÊ®ôÈ°åÂçÄ --- */
        .title-box {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            padding: 15px 25px;
            border-left: 4px solid var(--neon-blue);
            pointer-events: none;
        }
        .title-box * { pointer-events: auto; }

        .title-box h1 {
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #fff, var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        .title-box p {
            margin: 5px 0 0 0;
            font-size: 0.85rem;
            color: #aaa;
            letter-spacing: 1px;
        }

        /* --- 2. È†ÇÈÉ®ÊêúÂ∞ãÂàó --- */
        .search-box {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 300px;
            display: flex;
            align-items: center;
        }

        .search-box input {
            width: 100%;
            background: transparent;
            border: none;
            padding: 12px 20px;
            color: #fff;
            font-family: 'Orbitron', 'Noto Sans TC';
            font-size: 1rem;
            outline: none;
            letter-spacing: 1px;
        }
        
        .search-box input::placeholder { color: rgba(0, 243, 255, 0.5); }
        
        .search-icon {
            padding-right: 15px;
            color: var(--neon-blue);
            font-size: 1.2rem;
        }

        /* --- 3. Âè≥‰∏ãÊéßÂà∂Èù¢Êùø --- */
        .chart-panel {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            width: 340px;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
        }

        #toggleBtn {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            border-bottom: 1px solid var(--border-color);
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            cursor: pointer;
            padding: 10px;
            font-size: 0.9rem;
            letter-spacing: 2px;
            outline: none;
            border-radius: 12px 12px 0 0;
            transition: background 0.3s;
        }
        #toggleBtn:hover { background: rgba(0, 243, 255, 0.1); }

        .chart-content {
            padding: 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-blue) transparent;
        }
        .chart-content::-webkit-scrollbar { width: 6px; }
        .chart-content::-webkit-scrollbar-thumb { background-color: var(--neon-blue); border-radius: 3px; }

        .chart-panel h3 {
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--neon-pink);
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 8px;
        }
        .chart-panel h3:first-child { margin-top: 0; }

        /* Á≥ªÁµ±Êó•Ë™å */
        .system-log {
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(10, 255, 10, 0.3);
            border-radius: 4px;
            padding: 10px;
            height: 100px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: var(--neon-green);
            text-shadow: 0 0 5px rgba(10, 255, 10, 0.5);
            scrollbar-width: none;
        }
        .log-entry { margin-bottom: 4px; opacity: 0.8; }
        .log-entry::before { content: '> '; opacity: 0.5; }

        .panel-collapsed .chart-content { display: none; }
        .panel-collapsed #toggleBtn { border-bottom: none; border-radius: 12px; }
        .panel-collapsed { width: auto; min-width: 150px; }

        /* --- 4. ÂÆö‰ΩçÊåâÈàï --- */
        .locate-btn {
            position: absolute;
            bottom: 40px;
            left: 30px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--neon-blue);
            font-size: 1.5rem;
            transition: all 0.3s;
        }
        .locate-btn:hover {
            box-shadow: 0 0 20px var(--neon-blue);
            transform: scale(1.1);
            background: rgba(0, 243, 255, 0.2);
        }
        .locate-btn:active { transform: scale(0.95); }

        /* --- ÂëºÂê∏ÁáàÊ®ôË®ò --- */
        .glowing-dot {
            width: 14px;
            height: 14px;
            background-color: currentColor;
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
            position: relative;
        }
        .glowing-dot::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid currentColor;
            animation: pulse-ring 2.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
        }

        /* Leaflet Popup */
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background: rgba(16, 20, 30, 0.95) !important;
            color: #fff !important;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        .leaflet-popup-content b { color: var(--neon-blue); font-family: 'Noto Sans TC'; font-size: 1.1em;}
        .leaflet-container a.leaflet-popup-close-button { color: var(--neon-blue) !important; }

        /* RWD */
        @media (max-width: 600px) {
            .title-box { display: none; }
            .search-box { width: 80%; top: 15px; }
            .chart-panel { width: 85%; right: 7.5%; bottom: 90px; }
            .locate-btn { bottom: 25px; left: 25px; }
            .panel-collapsed { right: 20px; bottom: 20px; }
        }
    </style>
</head>
<body>

    <!-- Â∑¶‰∏äÊ®ôÈ°å -->
    <div class="title-box glass-panel">
        <h1>CHIAYI REGION<br>DRINKS MAP</h1>
        <p>ÂòâÁæ©Á∏£Â∏ÇÂÖ®ÂçÄ // È£≤ÊñôÂ∫óÊï∏ÊìöÁõ£Êéß‰∏≠...</p>
    </div>

    <!-- È†ÇÈÉ®ÊêúÂ∞ãÂàó -->
    <div class="search-box glass-panel">
        <input type="text" id="searchInput" placeholder="SEARCH TARGET..." onkeyup="filterMarkers()">
        <div class="search-icon">üîç</div>
    </div>

    <!-- Â∑¶‰∏ãÂÆö‰ΩçÊåâÈàï -->
    <div class="locate-btn glass-panel" onclick="locateUser()" title="Locate Me">
        ‚äï
    </div>

    <!-- Âè≥‰∏ãÊéßÂà∂Èù¢Êùø -->
    <div class="chart-panel glass-panel" id="statsPanel">
        <button id="toggleBtn" onclick="togglePanel()">‚ñº DATA MONITOR</button>
        
        <div class="chart-content">
            <h3>Brand Distribution</h3>
            <canvas id="brandChart"></canvas>
            
            <h3>Market Share</h3>
            <canvas id="shareChart"></canvas>
            
            <h3>System Log</h3>
            <div class="system-log" id="systemLog">
                <div class="log-entry">System initialized...</div>
                <div class="log-entry">Loading map data...</div>
                <div class="log-entry">Waiting for input...</div>
            </div>

            <div style="margin-top: 10px; font-size: 0.7rem; color: #666; text-align: center;">
                SECURE CONNECTION ESTABLISHED
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script>
        // --- 1. Ë≥áÊñôËàáË®≠ÂÆö ---
        const brandColors = {
            "50Âµê": "#ffe600", 
            "Ëø∑ÂÆ¢Â§è": "#00ff88", 
            "ÂèØ‰∏çÂèØ": "#ff4d4d",
            "Ê∏ÖÂøÉÁ¶èÂÖ®": "#00d2ff", 
            "È∫ªÂè§Ëå∂Âùä": "#ff00dd", 
            "Â§ßËãëÂ≠ê": "#55ff00",
            "Âæ°È¶ôÂ±ã": "#ffcc00", // ÂòâÁæ©ÂÇ≥Â•áËâ≤ (ÈáëÈªÉ)
            "ÂÖ∂‰ªñ": "#ffffff"
        };

        const shopsData = [
            // --- Ê∞ëÈõÑÂçÄ (ÂéüÊú¨ÁöÑË≥áÊñô) ---
            { name: "50Âµê Ê∞ëÈõÑÂª∫ÂúãÂ∫ó", brand: "50Âµê", lat: 23.5532, lng: 120.4295, note: "Ê∞ëÈõÑ - ‰∫∫ÊΩÆÂØÜÈõÜÂçÄ" },
            { name: "50Âµê Ê∞ëÈõÑÈ†≠Ê©ãÂ∫ó", brand: "50Âµê", lat: 23.5410, lng: 120.4380, note: "Ê∞ëÈõÑ - Â∑•Ê•≠ÂçÄ" },
            { name: "Ê∏ÖÂøÉÁ¶èÂÖ® Ê∞ëÈõÑ‰øùÁîüÂ∫ó", brand: "Ê∏ÖÂøÉÁ¶èÂÖ®", lat: 23.5525, lng: 120.4305, note: "Ê∞ëÈõÑ" },
            { name: "Ê∏ÖÂøÉÁ¶èÂÖ® Ê∞ëÈõÑÂª∫ÂúãÂ∫ó", brand: "Ê∏ÖÂøÉÁ¶èÂÖ®", lat: 23.5550, lng: 120.4285, note: "Ê∞ëÈõÑ" },
            { name: "È∫ªÂè§Ëå∂Âùä Ê∞ëÈõÑÂ∫ó", brand: "È∫ªÂè§Ëå∂Âùä", lat: 23.5528, lng: 120.4310, note: "Ê∞ëÈõÑ - ËäùËäùËë°ËêÑ" },
            { name: "ÂèØ‰∏çÂèØÁÜüÊàêÁ¥ÖËå∂ Ê∞ëÈõÑÂ∫ó", brand: "ÂèØ‰∏çÂèØ", lat: 23.5518, lng: 120.4320, note: "Ê∞ëÈõÑ" },
            { name: "Ëø∑ÂÆ¢Â§è Ê∞ëÈõÑÂ∫ó", brand: "Ëø∑ÂÆ¢Â§è", lat: 23.5522, lng: 120.4298, note: "Ê∞ëÈõÑ - ÁâßÂ†¥Áõ¥ÈÄÅ" },
            { name: "Â§ßËãëÂ≠ê Ê∞ëÈõÑÂ∫ó", brand: "Â§ßËãëÂ≠ê", lat: 23.5535, lng: 120.4290, note: "Ê∞ëÈõÑ - Â≠£ÁØÄÈÆÆÊûú" },
            { name: "Ê∞ëÈõÑÂú®Âú∞Á¥ÖËå∂ÂÜ∞", brand: "ÂÖ∂‰ªñ", lat: 23.5505, lng: 120.4340, note: "Ê∞ëÈõÑ - ‰øóÊì±Â§ßÁ¢ó" },

            // --- ÂòâÁæ©Â∏ÇÂçÄ (Êñ∞Ë≥áÊñô) ---
            { name: "Ê∫êËààÂæ°È¶ôÂ±ã", brand: "Âæ°È¶ôÂ±ã", lat: 23.4800, lng: 120.4490, note: "ÂòâÁæ©Â∏Ç - ÊéíÈöäÂÇ≥Â•á! Ëë°ËêÑÊüöÁ∂†Ëå∂" },
            { name: "Ê∫êËààÂæ°È¶ôÂ±ã ‰∏≠Ê≠£‰∫åÂ∫ó", brand: "Âæ°È¶ôÂ±ã", lat: 23.4795, lng: 120.4505, note: "ÂòâÁæ©Â∏Ç - ÂÇ≥Â•á‰∫åÂ∫ó" },
            { name: "50Âµê ÂòâÁæ©‰∏≠Â±±Â∫ó", brand: "50Âµê", lat: 23.4788, lng: 120.4455, note: "ÂòâÁæ©Â∏Ç - ËªäÁ´ôÂïÜÂúà" },
            { name: "50Âµê ÂòâÁæ©ÊñáÂåñÂ∫ó", brand: "50Âµê", lat: 23.4805, lng: 120.4495, note: "ÂòâÁæ©Â∏Ç - Â§úÂ∏ÇÊóÅ" },
            { name: "Ëø∑ÂÆ¢Â§è ÂòâÁæ©ÊûóÊ£ÆÂ∫ó", brand: "Ëø∑ÂÆ¢Â§è", lat: 23.4845, lng: 120.4480, note: "ÂòâÁæ©Â∏Ç - Ê™úÊÑèÊ£ÆÊ¥ªÊùëÈôÑËøë" },
            { name: "ÂèØ‰∏çÂèØ ÂòâÁæ©Ê∞ëÊóèÂ∫ó", brand: "ÂèØ‰∏çÂèØ", lat: 23.4760, lng: 120.4485, note: "ÂòâÁæ©Â∏Ç - Ê∞ëÊóèÂïÜÂúà" },
            { name: "È∫ªÂè§Ëå∂Âùä ÂòâÁæ©ËààÊ•≠Â∫ó", brand: "È∫ªÂè§Ëå∂Âùä", lat: 23.4720, lng: 120.4470, note: "ÂòâÁæ©Â∏Ç - ÂçóÂçÄÁÜ±Èªû" },
            { name: "Ê∏ÖÂøÉÁ¶èÂÖ® ÂòâÁæ©‰ªÅÊÑõÂ∫ó", brand: "Ê∏ÖÂøÉÁ¶èÂÖ®", lat: 23.4770, lng: 120.4440, note: "ÂòâÁæ©Â∏Ç - ÈõªÂΩ±Èô¢Â∞çÈù¢" },
            { name: "Áü•Êõ¥È≥•Â∑¢ÈÆÆÊûúËå∂È£≤", brand: "ÂÖ∂‰ªñ", lat: 23.4820, lng: 120.4490, note: "ÂòâÁæ©Â∏Ç - Âú®Âú∞Èö±ËóèÁâàÂ•ΩÂ∫ó" },

            // --- ÂòâÁæ©Á∏£ (Êú¥Â≠ê/Â§™‰øù) (Êñ∞Ë≥áÊñô) ---
            { name: "50Âµê Êú¥Â≠êÂ∫ó", brand: "50Âµê", lat: 23.4680, lng: 120.2450, note: "Êú¥Â≠ê - ÈÖçÂ§©ÂÆÆÈôÑËøë" },
            { name: "Â§ßËãëÂ≠ê ÂòâÁæ©Â§™‰øùÂ∫ó", brand: "Â§ßËãëÂ≠ê", lat: 23.4580, lng: 120.2930, note: "Â§™‰øù - Á∏£ÊîøÂ∫úÁâπÂçÄ" },
            { name: "Ëø∑ÂÆ¢Â§è ÂòâÁæ©Èï∑Â∫öÂ∫ó", brand: "Ëø∑ÂÆ¢Â§è", lat: 23.4605, lng: 120.2905, note: "Â§™‰øù - Èï∑Â∫öÈÜ´Èô¢" }
        ];

        let allMarkers = [];
        let userMarker = null;

        // --- 2. ÂàùÂßãÂåñÂú∞Âúñ ---
        // Ë™øÊï¥‰∏≠ÂøÉÈªûÂà∞ÂòâÁæ©Â∏ÇËàáÊ∞ëÈõÑ‰∏≠ÈñìÔºå‰∏¶Â∞áÁ∏ÆÊîæÂ±§Á¥öË®≠ÁÇ∫ 13 ‰ª•Ê∂µËìãÊõ¥Â§ßÁØÑÂúç
        const map = L.map('map', { zoomControl: false }).setView([23.5150, 120.4400], 13);
        L.control.zoom({ position: 'topright' }).addTo(map);

        const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO', maxZoom: 20
        }).addTo(map);

        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri', maxZoom: 17
        });

        // --- 3. Âª∫Á´ãÊ®ôË®ò ---
        const layers = {};
        const brandCounts = {};

        shopsData.forEach(shop => {
            let bName = shop.brand;
            if(!brandColors[bName]) bName = "ÂÖ∂‰ªñ";
            brandCounts[shop.brand] = (brandCounts[shop.brand] || 0) + 1;
            const myColor = brandColors[bName] || brandColors["ÂÖ∂‰ªñ"];

            // ÈáùÂ∞çÂæ°È¶ôÂ±ãÂÅöÁâπÊïàÔºöÊõ¥Â§ßÈ°Ü„ÄÅÊõ¥‰∫Æ
            const isLegendary = shop.brand === "Âæ°È¶ôÂ±ã";
            const scale = isLegendary ? 1.5 : 1.0;
            const zIndexOffset = isLegendary ? 1000 : 0;

            const glowingIcon = L.divIcon({
                className: 'custom-pin',
                html: `<div class="glowing-dot" style="color: ${myColor}; transform: scale(${scale});"></div>`,
                iconSize: [20, 20], iconAnchor: [10, 10], popupAnchor: [0, -10]
            });

            const marker = L.marker([shop.lat, shop.lng], { icon: glowingIcon, zIndexOffset: zIndexOffset })
                .bindPopup(`
                    <div style="font-family:'Orbitron'; font-size:0.8em; color:#888;">TARGET ACQUIRED</div>
                    <b style="color: ${myColor}">${shop.name}</b><br>
                    <span style="color:#aaa; border-top:1px solid #444; display:block; margin-top:4px; padding-top:4px;">${shop.note || "NO DATA"}</span>
                `);
            
            marker.on('click', () => logAction(`Selected: ${shop.name}`));

            if (!layers[shop.brand]) layers[shop.brand] = L.layerGroup();
            layers[shop.brand].addLayer(marker);
            allMarkers.push({ marker: marker, data: shop });
        });

        for (let key in layers) layers[key].addTo(map);
        L.control.layers({ "Cyber Mode": darkLayer, "Real World": satelliteLayer }, layers, { collapsed: true }).addTo(map);

        // --- 4. ÂäüËÉΩÈÇèËºØ (ÊêúÂ∞ã/ÂÆö‰Ωç/Êó•Ë™å) ---

        function filterMarkers() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            let count = 0;
            allMarkers.forEach(item => {
                const text = (item.data.name + item.data.brand + item.data.note).toLowerCase();
                if (text.includes(input)) {
                    item.marker.addTo(map);
                    count++;
                } else {
                    item.marker.remove();
                }
            });
            if(input.length > 0) logAction(`Search: "${input}" found ${count} targets`);
        }

        function locateUser() {
            logAction("Initiating GPS sequence...");
            map.locate({setView: true, maxZoom: 16});
            map.on('locationfound', function(e) {
                logAction(`User location locked at [${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}]`);
                if (userMarker) userMarker.remove();
                const userIcon = L.divIcon({
                    className: 'user-pin',
                    html: `<div class="glowing-dot" style="color: #00f3ff; transform: scale(1.5);"></div>`,
                    iconSize: [20, 20], iconAnchor: [10, 10]
                });
                userMarker = L.marker(e.latlng, {icon: userIcon}).addTo(map)
                    .bindPopup("<b>AGENT LOCATION</b><br>Current Status: Active").openPopup();
                L.circle(e.latlng, { radius: e.accuracy, color: '#00f3ff', weight: 1, fillOpacity: 0.1 }).addTo(map);
            });
            map.on('locationerror', function(e) {
                logAction("GPS Signal Lost: " + e.message);
                alert("ÁÑ°Ê≥ïÁç≤Âèñ‰ΩçÁΩÆÔºåË´ãÁ¢∫Ë™çÁÄèË¶ΩÂô®Ê¨äÈôê„ÄÇ");
            });
        }

        function logAction(msg) {
            const logBox = document.getElementById('systemLog');
            const time = new Date().toLocaleTimeString('en-US', {hour12: false});
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerText = `[${time}] ${msg}`;
            logBox.appendChild(entry);
            logBox.scrollTop = logBox.scrollHeight;
        }

        // --- 5. ÂúñË°®Áπ™Ë£Ω ---
        
        ['statsPanel', 'searchInput'].forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                L.DomEvent.disableScrollPropagation(el);
                L.DomEvent.disableClickPropagation(el);
            }
        });

        function togglePanel() {
            const panel = document.getElementById('statsPanel');
            const btn = document.getElementById('toggleBtn');
            const isCollapsed = panel.classList.toggle('panel-collapsed');
            btn.innerHTML = isCollapsed ? '‚ñ≤ DATA MONITOR' : '‚ñº DATA MONITOR';
        }

        Chart.defaults.color = '#aaaaaa';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';
        Chart.defaults.font.family = "'Orbitron', sans-serif";
        
        const labels = Object.keys(brandCounts);
        const dataValues = Object.values(brandCounts);
        const bgColors = labels.map(l => brandColors[l] || brandColors["ÂÖ∂‰ªñ"]);

        new Chart(document.getElementById('brandChart'), {
            type: 'bar',
            data: { labels, datasets: [{ data: dataValues, backgroundColor: bgColors, borderRadius: 3 }] },
            options: { 
                responsive: true, maintainAspectRatio: false, aspectRatio: 2,
                scales: { y: { beginAtZero: true }, x: { grid: { display: false } } },
                plugins: { legend: { display: false } }
            }
        });

        new Chart(document.getElementById('shareChart'), {
            type: 'doughnut',
            data: { labels, datasets: [{ data: dataValues, backgroundColor: bgColors, borderColor: '#10141e', borderWidth: 2 }] },
            options: { 
                responsive: true, maintainAspectRatio: false, aspectRatio: 2, cutout: '65%',
                plugins: { legend: { position: 'right', labels: { boxWidth: 8, usePointStyle: true, font: { size: 10 } } } }
            }
        });

        if (window.innerWidth < 600) togglePanel();

        logAction("Regional Map systems online.");
        logAction(`Loaded ${shopsData.length} targets across Chiayi.`);

    </script>
</body>
</html>
