<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”åéŸ³è¨˜æ†¶ç¥å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        html, body {
            touch-action: pan-x pan-y; 
            -ms-touch-action: pan-x pan-y;
            overscroll-behavior-y: none;
            background-color: #f8fafc;
            height: 100vh; 
            height: 100dvh; 
            width: 100%;
            overflow: hidden; 
        }
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .gpu-accelerated {
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
            will-change: transform;
        }
        .transition-transform-only {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-duration: 300ms;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }
        body { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        .swipe-overlay { transition: opacity 0.1s ease; pointer-events: none; }
    </style>
</head>
<body class="font-sans text-slate-800">

    <div id="app" class="flex flex-col h-full w-full md:flex-row">
        
        <aside class="hidden md:flex flex-col w-64 bg-white border-r border-slate-200 h-full shadow-sm z-20 shrink-0">
            <div class="p-6 border-b border-slate-100 flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">ã‚</div>
                <h1 class="font-bold text-xl text-slate-800">äº”åéŸ³è¨˜æ†¶</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <button @click="setActiveTab('list')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all" :class="activeTab === 'list' ? 'bg-indigo-50 text-indigo-600' : 'text-slate-500 hover:bg-slate-50'">
                    <icon-book size="20"></icon-book> å–®å­—åˆ—è¡¨
                </button>
                <button @click="setActiveTab('flashcards')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all" :class="activeTab === 'flashcards' ? 'bg-indigo-50 text-indigo-600' : 'text-slate-500 hover:bg-slate-50'">
                    <icon-layers size="20"></icon-layers> èƒŒå–®å­—å¡
                </button>
                <button @click="setActiveTab('quiz')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all" :class="activeTab === 'quiz' ? 'bg-indigo-50 text-indigo-600' : 'text-slate-500 hover:bg-slate-50'">
                    <icon-graduation-cap size="20"></icon-graduation-cap> è‡ªæˆ‘æ¸¬é©—
                </button>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col h-full relative overflow-hidden bg-slate-50">
            
            <header class="md:hidden h-12 bg-white border-b border-slate-200 flex items-center justify-center shrink-0 z-20 pt-safe shadow-sm">
                <h1 class="font-bold text-slate-800 text-lg">äº”åéŸ³è¨˜æ†¶ç¥å™¨</h1>
            </header>

            <main class="flex-1 overflow-hidden relative w-full flex flex-col">
                
                <div v-if="activeTab === 'list'" class="flex-1 overflow-y-auto no-scrollbar p-4 md:p-8 pb-24 md:pb-8">
                    <div class="max-w-5xl mx-auto">
                        
                        <div class="md:hidden bg-white p-2 rounded-2xl shadow-sm border border-slate-100 mb-6 flex gap-2">
                            <button @click="listFilterMode = 'all'" 
                                class="flex-1 py-3 rounded-xl flex flex-col items-center justify-center transition-all border-2"
                                :class="listFilterMode === 'all' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-transparent text-slate-500'">
                                <span class="text-xl font-bold">{{ vocabularyData.length }}</span>
                                <span class="text-[10px] font-bold">å…¨éƒ¨</span>
                            </button>
                            <button @click="listFilterMode = 'bookmarks'" 
                                class="flex-1 py-3 rounded-xl flex flex-col items-center justify-center transition-all border-2"
                                :class="listFilterMode === 'bookmarks' ? 'bg-yellow-50 border-yellow-200 text-yellow-700' : 'border-transparent text-slate-500'">
                                <span class="text-xl font-bold">{{ bookmarks.length }}</span>
                                <span class="text-[10px] font-bold">æ”¶è—</span>
                            </button>
                            <button @click="listFilterMode = 'missed'" 
                                class="flex-1 py-3 rounded-xl flex flex-col items-center justify-center transition-all border-2"
                                :class="listFilterMode === 'missed' ? 'bg-red-50 border-red-200 text-red-700' : 'border-transparent text-slate-500'">
                                <span class="text-xl font-bold">{{ missedIds.length }}</span>
                                <span class="text-[10px] font-bold">å¾…åŠ å¼·</span>
                            </button>
                        </div>

                        <div class="flex items-center justify-between mb-4 px-1">
                            <h2 class="font-bold text-slate-400 text-sm">
                                <span v-if="listFilterMode === 'all'">å…¨éƒ¨åˆ—è¡¨</span>
                                <span v-else-if="listFilterMode === 'bookmarks'">æˆ‘çš„æ”¶è—</span>
                                <span v-else>å¾…åŠ å¼·å–®å­—</span>
                            </h2>
                            <button v-if="listFilterMode !== 'all'" @click="listFilterMode = 'all'" class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">æ¸…é™¤ç¯©é¸</button>
                        </div>

                        <div v-if="Object.keys(groupedData).length === 0" class="text-center py-10 text-slate-400">
                            <div class="mb-2 text-4xl">ğŸ“­</div>
                            <p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å–®å­—</p>
                        </div>

                        <div class="space-y-6 pb-4">
                            <div v-for="(items, row) in groupedData" :key="row">
                                <div class="flex items-center gap-4 mb-3">
                                    <h3 class="text-lg font-bold text-slate-700">{{ row }}</h3>
                                    <div class="h-px flex-1 bg-slate-200"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4">
                                    <div v-for="item in items" :key="item.id" class="bg-white p-3 md:p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4 hover:shadow-md transition-all group">
                                        <div class="w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600 font-bold text-xl shrink-0">
                                            {{ item.kana }}
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-0.5 sm:gap-2">
                                                <span class="font-bold text-slate-800 text-lg leading-snug break-words">{{ item.word }}</span>
                                                <span class="text-xs text-slate-400 font-mono">{{ item.romaji }}</span>
                                            </div>
                                            <div class="text-sm text-slate-500 mt-0.5">{{ item.meaning }}</div>
                                            </div>
                                        <button @click.stop="toggleBookmark(item.id)" class="p-2 rounded-full hover:bg-slate-50 transition-colors shrink-0">
                                            <icon-star :filled="hasBookmark(item.id)" size="20" :class="hasBookmark(item.id) ? 'text-yellow-400' : 'text-slate-200'"></icon-star>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'flashcards'" class="flex-1 flex flex-col h-full relative overflow-hidden">
                    
                    <div v-if="!currentDeck || currentDeck.length === 0 || !currentDeck[currentIndex]" class="flex-1 flex flex-col items-center justify-center p-6 animate-fade-in">
                        <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-100 text-center max-w-sm w-full">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mb-6 text-indigo-600 mx-auto"><icon-layers size="40"></icon-layers></div>
                            <h2 class="text-xl font-bold text-slate-800 mb-2">æº–å‚™å¥½èƒŒå–®å­—äº†å—ï¼Ÿ</h2>
                            <div class="space-y-3 mt-6">
                                <button @click="startSession('all')" class="w-full flex items-center justify-center gap-3 bg-indigo-600 text-white px-6 py-4 rounded-xl font-bold shadow-md active:scale-95 transition-transform"><icon-layers></icon-layers> å…¨éƒ¨å–®å­— ({{ vocabularyData.length }})</button>
                                <button @click="startSession('bookmarks')" :disabled="bookmarks.length === 0" class="w-full flex items-center justify-center gap-3 bg-white border-2 border-slate-100 text-slate-700 px-6 py-4 rounded-xl font-bold active:scale-95 transition-transform disabled:opacity-50"><icon-star class="text-yellow-400" filled="true"></icon-star> æ”¶è—å–®å­— ({{ bookmarks.length }})</button>
                                <button v-if="missedIds.length > 0" @click="startSession('missed')" class="w-full flex items-center justify-center gap-3 bg-red-50 border-2 border-red-100 text-red-600 px-6 py-4 rounded-xl font-bold active:scale-95 transition-transform"><icon-refresh-cw></icon-refresh-cw> éŒ¯é¡Œè¤‡ç¿’ ({{ missedIds.length }})</button>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="roundComplete" class="flex-1 flex flex-col items-center justify-center p-6 animate-fade-in">
                        <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-100 text-center max-w-sm w-full">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-6 text-yellow-600 mx-auto"><icon-trophy size="40"></icon-trophy></div>
                            <h2 class="text-xl font-bold text-slate-800 mb-6">ç·´ç¿’å®Œæˆï¼</h2>
                            <div class="flex justify-center gap-8 mb-8">
                                <div><div class="text-3xl font-black text-green-500">{{ sessionLearnedCount }}</div><div class="text-xs text-slate-400 font-bold">æœ¬è¼ªè¨˜ä½</div></div>
                                <div><div class="text-3xl font-black text-red-500">{{ missedIds.length }}</div><div class="text-xs text-slate-400 font-bold">å‰©é¤˜å¾…åŠ å¼·</div></div>
                            </div>
                            <div class="space-y-3">
                                <button v-if="missedIds.length > 0" @click="startSession('missed')" class="w-full bg-indigo-600 text-white px-6 py-4 rounded-xl font-bold shadow-md active:scale-95 transition-transform">ç¹¼çºŒè¤‡ç¿’éŒ¯é¡Œ</button>
                                <button @click="startSession('all')" class="w-full bg-slate-100 text-slate-600 px-6 py-4 rounded-xl font-bold active:scale-95 transition-transform">å…¨éƒ¨é‡ä¾†</button>
                            </div>
                        </div>
                    </div>

                    <div v-else class="flex-1 flex flex-col h-full">
                        <div class="h-14 flex items-center justify-between px-4 md:px-8 shrink-0 z-10">
                            <button @click="toggleFlashcardMode" class="bg-white px-3 py-1.5 rounded-lg text-xs font-bold text-slate-600 border border-slate-200 shadow-sm flex items-center gap-2">
                                <icon-arrow-left-right size="14"></icon-arrow-left-right> {{ flashcardMode === 'jp-zh' ? 'æ—¥ â®• ä¸­' : 'ä¸­ â®• æ—¥' }}
                            </button>
                            <span class="font-mono font-bold text-slate-400 text-xs">{{ currentIndex + 1 }} / {{ currentDeck.length }}</span>
                            <div class="flex gap-2">
                                <button @click="shuffleDeck" class="p-2 bg-white rounded-lg border border-slate-200 text-slate-400 shadow-sm active:scale-95"><icon-shuffle size="16"></icon-shuffle></button>
                                <button @click="showDeckMenu = true" class="p-2 bg-indigo-50 rounded-lg border border-indigo-100 text-indigo-600 shadow-sm active:scale-95 relative">
                                    <icon-sliders size="16"></icon-sliders>
                                </button>
                            </div>
                        </div>

                        <div class="flex-1 flex items-center justify-center p-4 min-h-0 relative overflow-hidden">
                            <button @click="prevCard" class="hidden md:flex p-4 rounded-full text-slate-400 hover:bg-white hover:text-indigo-600 transition-colors absolute left-4 z-20" :disabled="currentIndex === 0">
                                <icon-chevron-left size="40"></icon-chevron-left>
                            </button>

                            <div class="relative w-full max-w-sm h-full max-h-[420px] md:max-h-[500px] aspect-[3/4] md:aspect-[4/3] perspective-1000 cursor-grab active:cursor-grabbing"
                                 @touchstart="onTouchStart" @touchmove="onTouchMove" @touchend="onTouchEnd"
                                 @mousedown="onTouchStart" @mousemove="onTouchMove" @mouseup="onTouchEnd" @mouseleave="onTouchEnd"
                                 @click="handleCardClick">
                                
                                <div class="relative w-full h-full transition-transform-only preserve-3d gpu-accelerated" :style="cardContainerStyle">
                                    <div class="relative w-full h-full transition-transform-only preserve-3d" :class="{ 'rotate-y-180': isFlipped }">
                                        <div class="absolute inset-0 backface-hidden bg-white rounded-3xl shadow-xl border border-white flex flex-col items-center justify-center p-8 z-10">
                                            <div class="absolute inset-0 bg-green-500/10 flex items-center justify-center z-20 swipe-overlay" :style="{ opacity: swipeOverlayOpacity.right }"><div class="bg-white/90 p-4 rounded-full shadow-lg"><icon-check class="text-green-500" size="48"></icon-check></div></div>
                                            <div class="absolute inset-0 bg-red-500/10 flex items-center justify-center z-20 swipe-overlay" :style="{ opacity: swipeOverlayOpacity.left }"><div class="bg-white/90 p-4 rounded-full shadow-lg"><icon-x class="text-red-500" size="48"></icon-x></div></div>
                                            
                                            <button @click.stop="toggleBookmark(currentItem.id)" class="absolute top-4 right-4 p-2 rounded-full z-30" @mousedown.stop @touchstart.stop>
                                                <icon-star :filled="hasBookmark(currentItem.id)" size="28" :class="hasBookmark(currentItem.id) ? 'text-yellow-400' : 'text-slate-200'"></icon-star>
                                            </button>
                                            
                                            <span class="text-xs font-bold text-indigo-300 tracking-widest mb-4">QUESTION</span>
                                            <h2 class="font-bold text-slate-800 text-center break-words" :class="flashcardMode === 'jp-zh' ? 'text-6xl' : 'text-4xl'">
                                                {{ flashcardMode === 'jp-zh' ? currentItem.word : currentItem.meaning }}
                                            </h2>
                                            <p class="mt-8 text-slate-300 text-xs font-bold animate-pulse">è¼•é»ç¿»é¢ / æ»‘å‹•è©•åˆ†</p>
                                        </div>

                                        <div class="absolute inset-0 backface-hidden bg-indigo-600 rounded-3xl shadow-xl border border-indigo-500 rotate-y-180 flex flex-col items-center justify-center p-8 text-white">
                                            <div class="absolute inset-0 bg-green-500/20 flex items-center justify-center z-20 swipe-overlay" :style="{ opacity: swipeOverlayOpacity.right }"><icon-check class="text-white" size="64"></icon-check></div>
                                            <div class="absolute inset-0 bg-red-500/20 flex items-center justify-center z-20 swipe-overlay" :style="{ opacity: swipeOverlayOpacity.left }"><icon-x class="text-white" size="64"></icon-x></div>

                                            <button @click.stop="toggleBookmark(currentItem.id)" class="absolute top-4 right-4 p-2 rounded-full z-30" @mousedown.stop @touchstart.stop>
                                                <icon-star :filled="hasBookmark(currentItem.id)" size="28" :class="hasBookmark(currentItem.id) ? 'text-yellow-400' : 'text-white/30'"></icon-star>
                                            </button>
                                            <span class="absolute top-6 left-6 text-7xl font-black text-white/10 select-none">{{ currentItem.kana }}</span>
                                            
                                            <div class="z-10 text-center w-full">
                                                <template v-if="flashcardMode === 'jp-zh'">
                                                    <div class="text-4xl font-bold opacity-90 mb-2">{{ currentItem.kanji }}</div>
                                                    <div class="text-xl opacity-60 font-mono mb-6">{{ currentItem.romaji }}</div>
                                                    <div class="w-12 h-1 bg-white/30 rounded-full mx-auto mb-6"></div>
                                                    <div class="text-3xl font-bold">{{ currentItem.meaning }}</div>
                                                </template>
                                                <template v-else>
                                                    <div class="text-xs opacity-60 mb-4 font-bold tracking-widest">ANSWER</div>
                                                    <div class="text-5xl font-bold mb-4">{{ currentItem.word }}</div>
                                                    <div class="text-2xl opacity-80">{{ currentItem.kanji }}</div>
                                                    <div class="text-lg opacity-60 font-mono mt-2">{{ currentItem.romaji }}</div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button @click="nextCard" class="hidden md:flex p-4 rounded-full text-slate-400 hover:bg-white hover:text-indigo-600 transition-colors absolute right-4 z-20" :disabled="currentIndex === currentDeck.length - 1">
                                <icon-chevron-right size="40"></icon-chevron-right>
                            </button>
                        </div>

                        <div class="h-16 shrink-0 w-full max-w-md px-4 flex gap-3 mb-4 md:hidden mx-auto">
                            <template v-if="mobileControlMode === 'nav'">
                                <button @click="prevCard" class="flex-1 bg-white border-2 border-slate-200 text-slate-500 rounded-2xl font-bold shadow-sm flex flex-col items-center justify-center active:scale-95 transition-transform active:bg-slate-50">
                                    <icon-chevron-left size="20"></icon-chevron-left>
                                    <span class="text-[10px] mt-0.5">ä¸Šä¸€å¼µ</span>
                                </button>
                                <button @click="nextCard" class="flex-1 bg-white border-2 border-slate-200 text-slate-500 rounded-2xl font-bold shadow-sm flex flex-col items-center justify-center active:scale-95 transition-transform active:bg-slate-50">
                                    <icon-chevron-right size="20"></icon-chevron-right>
                                    <span class="text-[10px] mt-0.5">ä¸‹ä¸€å¼µ</span>
                                </button>
                            </template>
                            
                            <template v-else>
                                <button @click="handleCardResult('missed')" class="flex-1 bg-white border-2 border-red-100 text-red-500 rounded-2xl font-bold shadow-sm flex items-center justify-center gap-2 hover:bg-red-50 transition-colors active:scale-95">
                                    <icon-x></icon-x> æ²’è¨˜ä½ (â†)
                                </button>
                                <button @click="handleCardResult('memorized')" class="flex-1 bg-white border-2 border-green-100 text-green-600 rounded-2xl font-bold shadow-sm flex items-center justify-center gap-2 hover:bg-green-50 transition-colors active:scale-95">
                                    <icon-check></icon-check> è¨˜ä½äº† (â†’)
                                </button>
                            </template>
                        </div>

                        <div class="hidden md:flex h-20 shrink-0 w-full max-w-md px-4 gap-4 mb-4 mx-auto">
                            <button @click="handleCardResult('missed')" class="flex-1 bg-white border-2 border-red-100 text-red-500 rounded-2xl font-bold shadow-sm flex items-center justify-center gap-2 hover:bg-red-50 transition-colors">
                                <icon-x></icon-x> æ²’è¨˜ä½ (â†)
                            </button>
                            <button @click="handleCardResult('memorized')" class="flex-1 bg-white border-2 border-green-100 text-green-600 rounded-2xl font-bold shadow-sm flex items-center justify-center gap-2 hover:bg-green-50 transition-colors">
                                <icon-check></icon-check> è¨˜ä½äº† (â†’)
                            </button>
                        </div>

                        <transition name="modal">
                            <div v-if="showDeckMenu" class="absolute inset-0 bg-black/50 z-50 flex items-center justify-center p-4" @click.self="showDeckMenu = false">
                                <div class="bg-white w-full max-w-xs rounded-2xl shadow-2xl p-6 animate-fade-in">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="text-lg font-bold text-slate-800">å¡ç‰‡è¨­å®š</h3>
                                        <button @click="showDeckMenu = false" class="p-2 text-slate-400 hover:text-slate-600"><icon-x size="20"></icon-x></button>
                                    </div>
                                    
                                    <div class="mb-6 md:hidden">
                                        <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">åº•éƒ¨æŒ‰éˆ•åŠŸèƒ½</label>
                                        <div class="flex p-1 bg-slate-100 rounded-xl">
                                            <button @click="mobileControlMode = 'nav'" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all" :class="mobileControlMode === 'nav' ? 'bg-white shadow text-indigo-600' : 'text-slate-400'">
                                                ç¿»é 
                                            </button>
                                            <button @click="mobileControlMode = 'grade'" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all" :class="mobileControlMode === 'grade' ? 'bg-white shadow text-indigo-600' : 'text-slate-400'">
                                                è©•åˆ†
                                            </button>
                                        </div>
                                    </div>

                                    <div class="space-y-3">
                                        <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">åˆ‡æ›é¡Œåº«</label>
                                        <button @click="startSession('all'); showDeckMenu = false" class="w-full flex items-center gap-3 p-3 rounded-xl border-2 hover:border-indigo-200 hover:bg-indigo-50 transition-all" :class="currentSessionType === 'all' ? 'border-indigo-600 bg-indigo-50' : 'border-slate-100'">
                                            <icon-layers size="20" class="text-indigo-600"></icon-layers> å…¨éƒ¨å–®å­—
                                        </button>
                                        <button @click="startSession('bookmarks'); showDeckMenu = false" :disabled="bookmarks.length === 0" class="w-full flex items-center gap-3 p-3 rounded-xl border-2 hover:border-indigo-200 hover:bg-indigo-50 transition-all disabled:opacity-50" :class="currentSessionType === 'bookmarks' ? 'border-indigo-600 bg-indigo-50' : 'border-slate-100'">
                                            <icon-star size="20" class="text-yellow-400" filled="true"></icon-star> æ”¶è—å–®å­—
                                        </button>
                                        <button @click="startSession('missed'); showDeckMenu = false" :disabled="missedIds.length === 0" class="w-full flex items-center gap-3 p-3 rounded-xl border-2 hover:border-red-200 hover:bg-red-50 transition-all disabled:opacity-50" :class="currentSessionType === 'missed' ? 'border-red-500 bg-red-50' : 'border-slate-100'">
                                            <icon-refresh-cw size="20" class="text-red-500"></icon-refresh-cw> éŒ¯é¡Œè¤‡ç¿’
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </transition>
                    </div>
                </div>

                <div v-if="activeTab === 'quiz'" class="flex-1 overflow-y-auto no-scrollbar pb-20">
                     <div v-if="quizPhase === 'setup'" class="flex flex-col items-center justify-center min-h-full p-6 animate-fade-in">
                        <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-100 w-full max-w-sm">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mb-6 text-indigo-600 mx-auto"><icon-settings size="32"></icon-settings></div>
                            <h2 class="text-xl font-bold text-slate-800 mb-6 text-center">æ¸¬é©—è¨­å®š</h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">é¡Œåº«ä¾†æº</label>
                                    <div class="grid grid-cols-3 gap-2">
                                        <button @click="quizConfig.source = 'all'" class="py-2 rounded-lg font-bold border-2 text-sm transition-colors" :class="quizConfig.source === 'all' ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-100 text-slate-500'">å…¨éƒ¨</button>
                                        <button @click="quizConfig.source = 'bookmarks'" :disabled="bookmarks.length === 0" class="py-2 rounded-lg font-bold border-2 text-sm transition-colors disabled:opacity-50" :class="quizConfig.source === 'bookmarks' ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-100 text-slate-500'">æ”¶è—</button>
                                        <button @click="quizConfig.source = 'missed'" :disabled="missedIds.length === 0" class="py-2 rounded-lg font-bold border-2 text-sm transition-colors disabled:opacity-50" :class="quizConfig.source === 'missed' ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-100 text-slate-500'">éŒ¯é¡Œ</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">é¡Œç›®æ•¸é‡</label>
                                    <div class="grid grid-cols-4 gap-2">
                                        <button v-for="opt in [5, 10, 20, 'all']" :key="opt" @click="quizConfig.count = opt" class="py-2 rounded-lg font-bold border-2 text-sm transition-colors" :class="quizConfig.count === opt ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-100 text-slate-500'">{{ opt === 'all' ? 'å…¨éƒ¨' : opt }}</button>
                                    </div>
                                </div>
                                <button @click="startQuiz" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 mt-4"><icon-play-circle size="20"></icon-play-circle> é–‹å§‹æ¸¬é©—</button>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="quizPhase === 'playing'" class="flex flex-col min-h-full max-w-2xl mx-auto w-full p-4 md:p-8 relative">
                        <button @click="quizPhase = 'setup'" class="absolute top-4 left-4 p-2 text-slate-400 active:text-red-500 z-20"><icon-x size="24"></icon-x></button>
                        <div class="flex justify-end mb-4 mt-2">
                            <span class="font-bold text-indigo-600 bg-indigo-50 px-3 py-1 rounded-lg text-sm">Q. {{ quizState.currentQIndex + 1 }} / {{ quizState.questions.length }}</span>
                        </div>
                        <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100 text-center mb-4 relative overflow-hidden flex-1 flex flex-col justify-center items-center min-h-[200px]">
                            <div v-if="quizState.lastCorrect === true" class="absolute inset-0 bg-green-500/10 flex items-center justify-center z-10 animate-fade-in"><icon-check class="text-green-500 drop-shadow-md" size="80"></icon-check></div>
                            <div v-if="quizState.lastCorrect === false" class="absolute inset-0 bg-red-500/10 flex items-center justify-center z-10 animate-fade-in"><icon-x class="text-red-500 drop-shadow-md" size="80"></icon-x></div>
                            <span class="text-xs font-bold text-indigo-300 tracking-widest mb-4">QUESTION</span>
                            <h2 class="text-4xl font-bold text-slate-800 mb-2">{{ quizConfig.mode === 'jp-zh' ? currentQuizItem.word : currentQuizItem.meaning }}</h2>
                            <p v-if="quizConfig.mode === 'jp-zh'" class="text-indigo-400 text-xl">{{ currentQuizItem.kana }}</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 shrink-0 pb-4">
                            <button v-for="(opt, i) in quizState.options" :key="i" :disabled="quizState.lastCorrect !== null" @click="handleQuizAnswer(opt)" class="p-4 rounded-xl text-left font-bold border-2 transition-all relative overflow-hidden" :class="getQuizOptionClass(opt)">{{ quizConfig.mode === 'jp-zh' ? opt.meaning : `${opt.word}` }}</button>
                        </div>
                    </div>

                    <div v-else-if="quizPhase === 'result'" class="flex flex-col items-center justify-center min-h-full p-6 text-center animate-fade-in">
                        <div class="text-8xl mb-6">{{ quizPercentage >= 80 ? 'ğŸ‰' : 'ğŸ’ª' }}</div>
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">æ¸¬é©—çµæŸ</h2>
                        <div class="my-8 p-6 bg-white rounded-2xl shadow-md border border-slate-100 w-full max-w-xs">
                            <div class="text-5xl font-black text-indigo-600 mb-2">{{ quizPercentage }}%</div>
                            <div class="text-slate-400 font-bold">ç­”å° {{ quizState.score }} / {{ quizState.questions.length }} é¡Œ</div>
                        </div>
                        <button @click="quizPhase = 'setup'" class="bg-indigo-600 text-white px-8 py-3 rounded-full font-bold shadow-lg active:scale-95 transition-transform flex items-center gap-2"><icon-rotate-ccw size="20"></icon-rotate-ccw> å†æ¸¬é©—ä¸€æ¬¡</button>
                    </div>
                </div>

            </main>
        </div>

        <nav class="md:hidden h-16 bg-white border-t border-slate-200 flex justify-around p-1 pb-safe shrink-0 z-50">
            <button @click="setActiveTab('list')" class="w-16 flex flex-col items-center justify-center rounded-xl transition-colors" :class="activeTab === 'list' ? 'text-indigo-600' : 'text-slate-400'">
                <icon-book size="24"></icon-book>
                <span class="text-[10px] font-bold mt-1">åˆ—è¡¨</span>
            </button>
            <button @click="setActiveTab('flashcards')" class="w-16 flex flex-col items-center justify-center rounded-xl transition-colors" :class="activeTab === 'flashcards' ? 'text-indigo-600' : 'text-slate-400'">
                <icon-layers size="24"></icon-layers>
                <span class="text-[10px] font-bold mt-1">èƒŒå–®å­—</span>
            </button>
            <button @click="setActiveTab('quiz')" class="w-16 flex flex-col items-center justify-center rounded-xl transition-colors" :class="activeTab === 'quiz' ? 'text-indigo-600' : 'text-slate-400'">
                <icon-graduation-cap size="24"></icon-graduation-cap>
                <span class="text-[10px] font-bold mt-1">æ¸¬é©—</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted, onUnmounted } = Vue;

        const vocabularyData = [
            { id: 'a1', kana: 'ã‚', word: 'ã‚ã—', kanji: 'è¶³', romaji: 'ashi', meaning: 'è…³ / è…¿', row: 'ã‚è¡Œ' },
            { id: 'a2', kana: 'ã„', word: 'ã„ã™', kanji: 'æ¤…å­', romaji: 'isu', meaning: 'æ¤…å­', row: 'ã‚è¡Œ' },
            { id: 'a3', kana: 'ã†', word: 'ã†ã—', kanji: 'ç‰›', romaji: 'ushi', meaning: 'ç‰›', row: 'ã‚è¡Œ' },
            { id: 'a4', kana: 'ãˆ', word: 'ãˆã', kanji: 'é§…', romaji: 'eki', meaning: 'è»Šç«™', row: 'ã‚è¡Œ' },
            { id: 'a5', kana: 'ãŠ', word: 'ãŠã‹ã—', kanji: 'ãŠè“å­', romaji: 'okashi', meaning: 'é»å¿ƒ / ç³–æœ', row: 'ã‚è¡Œ' },
            { id: 'k1', kana: 'ã‹', word: 'ã‹ãŠ', kanji: 'é¡”', romaji: 'kao', meaning: 'è‡‰', row: 'ã‹è¡Œ' },
            { id: 'k2', kana: 'ã', word: 'ãã', kanji: 'èŠ', romaji: 'kiku', meaning: 'èŠèŠ±', row: 'ã‹è¡Œ' },
            { id: 'k3', kana: 'ã', word: 'ãã—', kanji: 'æ«›', romaji: 'kushi', meaning: 'æ¢³å­', row: 'ã‹è¡Œ' },
            { id: 'k4', kana: 'ã‘', word: 'ã‘ã—ã', kanji: 'æ™¯è‰²', romaji: 'keshiki', meaning: 'é¢¨æ™¯', row: 'ã‹è¡Œ' },
            { id: 'k5', kana: 'ã“', word: 'ã“ã„', kanji: 'é¯‰', romaji: 'koi', meaning: 'é¯‰é­š', row: 'ã‹è¡Œ' },
            { id: 's1', kana: 'ã•', word: 'ã•ã‘', kanji: 'é…’', romaji: 'sake', meaning: 'é…’', row: 'ã•è¡Œ' },
            { id: 's2', kana: 'ã—', word: 'ã—ã‹', kanji: 'é¹¿', romaji: 'shika', meaning: 'é¹¿', row: 'ã•è¡Œ' },
            { id: 's3', kana: 'ã™', word: 'ã™ã—', kanji: 'å¯¿å¸', romaji: 'sushi', meaning: 'å£½å¸', row: 'ã•è¡Œ' },
            { id: 's4', kana: 'ã›', word: 'ã›ãªã‹', kanji: 'èƒŒä¸­', romaji: 'senaka', meaning: 'èƒŒéƒ¨', row: 'ã•è¡Œ' },
            { id: 's5', kana: 'ã', word: 'ãã†ã˜', kanji: 'æƒé™¤', romaji: 'souji', meaning: 'æ‰“æƒ', row: 'ã•è¡Œ' },
            { id: 't1', kana: 'ãŸ', word: 'ãŸã“', kanji: 'è›¸', romaji: 'tako', meaning: 'ç« é­š', row: 'ãŸè¡Œ' },
            { id: 't2', kana: 'ã¡', word: 'ã¡ãš', kanji: 'åœ°å›³', romaji: 'chizu', meaning: 'åœ°åœ–', row: 'ãŸè¡Œ' },
            { id: 't3', kana: 'ã¤', word: 'ã¤ããˆ', kanji: 'æœº', romaji: 'tsukue', meaning: 'æ›¸æ¡Œ', row: 'ãŸè¡Œ' },
            { id: 't4', kana: 'ã¦', word: 'ã¦', kanji: 'æ‰‹', romaji: 'te', meaning: 'æ‰‹', row: 'ãŸè¡Œ' },
            { id: 't5', kana: 'ã¨', word: 'ã¨ã‘ã„', kanji: 'æ™‚è¨ˆ', romaji: 'tokei', meaning: 'æ™‚é˜ / æ‰‹éŒ¶', row: 'ãŸè¡Œ' },
            { id: 'n1', kana: 'ãª', word: 'ãªã—', kanji: 'æ¢¨', romaji: 'nashi', meaning: 'æ¢¨å­', row: 'ãªè¡Œ' },
            { id: 'n2', kana: 'ã«', word: 'ã«ã', kanji: 'è‚‰', romaji: 'niku', meaning: 'è‚‰', row: 'ãªè¡Œ' },
            { id: 'n3', kana: 'ã¬', word: 'ã„ã¬', kanji: 'çŠ¬', romaji: 'inu', meaning: 'ç‹—', row: 'ãªè¡Œ', note: 'å–å­—å°¾éŸ³' },
            { id: 'n4', kana: 'ã­', word: 'ã­ã“', kanji: 'çŒ«', romaji: 'neko', meaning: 'è²“', row: 'ãªè¡Œ' },
            { id: 'n5', kana: 'ã®', word: 'ãã®ã“', kanji: 'èŒ¸', romaji: 'kinoko', meaning: 'è˜‘è‡', row: 'ãªè¡Œ', note: 'å–ä¸­é–“éŸ³' },
            { id: 'h1', kana: 'ã¯', word: 'ã¯ãª', kanji: 'èŠ±', romaji: 'hana', meaning: 'èŠ±', row: 'ã¯è¡Œ' },
            { id: 'h2', kana: 'ã²', word: 'ã²ã“ã†ã', kanji: 'é£›è¡Œæ©Ÿ', romaji: 'hikouki', meaning: 'é£›æ©Ÿ', row: 'ã¯è¡Œ' },
            { id: 'h3', kana: 'ãµ', word: 'ãµã­', kanji: 'èˆ¹', romaji: 'fune', meaning: 'èˆ¹', row: 'ã¯è¡Œ' },
            { id: 'h4', kana: 'ã¸', word: 'ã¸ã‚„', kanji: 'éƒ¨å±‹', romaji: 'heya', meaning: 'æˆ¿é–“', row: 'ã¯è¡Œ' },
            { id: 'h5', kana: 'ã»', word: 'ã»ã—', kanji: 'æ˜Ÿ', romaji: 'hoshi', meaning: 'æ˜Ÿæ˜Ÿ', row: 'ã¯è¡Œ' },
            { id: 'm1', kana: 'ã¾', word: 'ã¾ãã‚‰', kanji: 'æ•', romaji: 'makura', meaning: 'æ•é ­', row: 'ã¾è¡Œ' },
            { id: 'm2', kana: 'ã¿', word: 'ã¿ã¿', kanji: 'è€³', romaji: 'mimi', meaning: 'è€³æœµ', row: 'ã¾è¡Œ' },
            { id: 'm3', kana: 'ã‚€', word: 'ã‚€ã­', kanji: 'èƒ¸', romaji: 'mune', meaning: 'èƒ¸éƒ¨', row: 'ã¾è¡Œ' },
            { id: 'm4', kana: 'ã‚', word: 'ã‚ã„ã—', kanji: 'ååˆº', romaji: 'meishi', meaning: 'åç‰‡', row: 'ã¾è¡Œ' },
            { id: 'm5', kana: 'ã‚‚', word: 'ã‚‚ã‚‚', kanji: 'æ¡ƒ', romaji: 'momo', meaning: 'æ¡ƒå­', row: 'ã¾è¡Œ' },
            { id: 'y1', kana: 'ã‚„', word: 'ã‚„ã¾', kanji: 'å±±', romaji: 'yama', meaning: 'ã‚„è¡Œ' },
            { id: 'y2', kana: 'ã‚†', word: 'ã‚†ã‹ãŸ', kanji: 'æµ´è¡£', romaji: 'yukata', meaning: 'æµ´è¡£', row: 'ã‚„è¡Œ' },
            { id: 'y3', kana: 'ã‚ˆ', word: 'ã‚ˆã‚‹', kanji: 'å¤œ', romaji: 'yoru', meaning: 'å¤œæ™š', row: 'ã‚„è¡Œ' },
            { id: 'r1', kana: 'ã‚‰', word: 'ã¨ã‚‰', kanji: 'è™', romaji: 'tora', meaning: 'è€è™', row: 'ã‚‰è¡Œ', note: 'å–å­—å°¾éŸ³' },
            { id: 'r2', kana: 'ã‚Š', word: 'ã¨ã‚Š', kanji: 'é³¥', romaji: 'tori', meaning: 'é³¥', row: 'ã‚‰è¡Œ', note: 'å–å­—å°¾éŸ³' },
            { id: 'r3', kana: 'ã‚‹', word: 'ãã‚‹ã¾', kanji: 'è»Š', romaji: 'kuruma', meaning: 'è»Šå­', row: 'ã‚‰è¡Œ', note: 'å–ä¸­é–“éŸ³' },
            { id: 'r4', kana: 'ã‚Œ', word: 'ã™ã¿ã‚Œ', kanji: 'è«', romaji: 'sumire', meaning: 'ç´«ç¾…è˜­', row: 'ã‚‰è¡Œ', note: 'å–å­—å°¾éŸ³' },
            { id: 'r5', kana: 'ã‚', word: 'ã—ã‚', kanji: 'åŸ', romaji: 'shiro', meaning: 'åŸå ¡', row: 'ã‚‰è¡Œ', note: 'å–å­—å°¾éŸ³' },
            { id: 'w1', kana: 'ã‚', word: 'ã‚ã«', kanji: 'é°', romaji: 'wani', meaning: 'é±·é­š', row: 'ã‚è¡Œãƒ»å…¶ä»–' },
            { id: 'w2', kana: 'ã‚’', word: 'ã‹ãŠã‚’ã‚ã‚‰ã„ã¾ã™', kanji: 'é¡”ã‚’æ´—ã„ã¾ã™', romaji: 'kao wo araimasu', meaning: 'æ´—è‡‰', row: 'ã‚è¡Œãƒ»å…¶ä»–', note: 'åŠ©è©ç”¨æ³•' },
            { id: 'w3', kana: 'ã‚“', word: 'ã»ã‚“', kanji: 'æœ¬', romaji: 'hon', meaning: 'æ›¸', row: 'ã‚è¡Œãƒ»å…¶ä»–', note: 'å–å­—å°¾éŸ³' },
        ];

        const Icon = {
            props: ['name', 'size', 'filled'],
            template: `
                <svg v-if="name === 'book'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                <svg v-else-if="name === 'layers'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                <svg v-else-if="name === 'graduation-cap'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>
                <svg v-else-if="name === 'rotate-ccw'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                <svg v-else-if="name === 'check'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                <svg v-else-if="name === 'x'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                <svg v-else-if="name === 'shuffle'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                <svg v-else-if="name === 'arrow-left-right'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3 4 7l4 4"></path><path d="M4 7h16"></path><path d="M16 21l4-4-4-4"></path><path d="M20 17H4"></path></svg>
                <svg v-else-if="name === 'star'" :width="size||24" :height="size||24" viewBox="0 0 24 24" :fill="filled ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                <svg v-else-if="name === 'refresh-cw'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path></svg>
                <svg v-else-if="name === 'trophy'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 1 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
                <svg v-else-if="name === 'settings'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                <svg v-else-if="name === 'play-circle'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                <svg v-else-if="name === 'chevron-left'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <svg v-else-if="name === 'chevron-right'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                <svg v-else-if="name === 'sliders'" :width="size||24" :height="size||24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
            `
        };

        const app = createApp({
            components: {
                'icon-book': { ...Icon, data() { return { name: 'book' } } },
                'icon-layers': { ...Icon, data() { return { name: 'layers' } } },
                'icon-graduation-cap': { ...Icon, data() { return { name: 'graduation-cap' } } },
                'icon-rotate-ccw': { ...Icon, data() { return { name: 'rotate-ccw' } } },
                'icon-check': { ...Icon, data() { return { name: 'check' } } },
                'icon-x': { ...Icon, data() { return { name: 'x' } } },
                'icon-shuffle': { ...Icon, data() { return { name: 'shuffle' } } },
                'icon-arrow-left-right': { ...Icon, data() { return { name: 'arrow-left-right' } } },
                'icon-star': { ...Icon, data() { return { name: 'star' } } },
                'icon-refresh-cw': { ...Icon, data() { return { name: 'refresh-cw' } } },
                'icon-trophy': { ...Icon, data() { return { name: 'trophy' } } },
                'icon-settings': { ...Icon, data() { return { name: 'settings' } } },
                'icon-play-circle': { ...Icon, data() { return { name: 'play-circle' } } },
                'icon-chevron-left': { ...Icon, data() { return { name: 'chevron-left' } } },
                'icon-chevron-right': { ...Icon, data() { return { name: 'chevron-right' } } },
                'icon-sliders': { ...Icon, data() { return { name: 'sliders' } } },
            },
            setup() {
                const activeTab = ref('list');
                const listFilterMode = ref('all'); // æ–°å¢ï¼šæ§åˆ¶åˆ—è¡¨ç¯©é¸ 'all', 'bookmarks', 'missed'
                const mobileControlMode = ref('nav'); // æ–°å¢ï¼šæ§åˆ¶æ‰‹æ©Ÿåº•éƒ¨æŒ‰éˆ• 'nav' (ç¿»é ), 'grade' (è©•åˆ†)

                const currentDeck = ref([]);
                const currentIndex = ref(0);
                const isFlipped = ref(false);
                const flashcardMode = ref('jp-zh');
                const memorizedIds = ref([]);
                const missedIds = ref([]);
                const bookmarks = ref([]);
                const roundComplete = ref(false);
                const showDeckMenu = ref(false);
                const currentSessionType = ref('all');

                const dragX = ref(0);
                const isDragging = ref(false);
                const cardTransition = ref('transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)');

                const quizPhase = ref('setup');
                const quizConfig = ref({ mode: 'jp-zh', count: 10, source: 'all' });
                const quizState = ref({ score: 0, currentQIndex: 0, options: [], lastCorrect: null, questions: [] });

                // Computed
                const groupedData = computed(() => {
                    // æ–°å¢ï¼šå…ˆéæ¿¾ï¼Œå†åˆ†çµ„
                    let data = vocabularyData;
                    if (listFilterMode.value === 'bookmarks') data = data.filter(item => bookmarks.value.includes(item.id));
                    else if (listFilterMode.value === 'missed') data = data.filter(item => missedIds.value.includes(item.id));

                    return data.reduce((acc, item) => {
                        if (!acc[item.row]) acc[item.row] = [];
                        acc[item.row].push(item);
                        return acc;
                    }, {});
                });

                const currentItem = computed(() => currentDeck.value[currentIndex.value] || {});
                const currentQuizItem = computed(() => quizState.value.questions[quizState.value.currentQIndex] || {});
                const sessionLearnedCount = computed(() => memorizedIds.value.length);
                const quizPercentage = computed(() => Math.round((quizState.value.score / quizState.value.questions.length) * 100) || 0);

                const cardContainerStyle = computed(() => {
                    const rotate = dragX.value / 20;
                    // ç¢ºä¿æ‹–æ›³ç‚º 0 æ™‚æœ‰é è¨­å€¼
                    return {
                        transform: `translate3d(${dragX.value}px, 0, 0) rotate(${rotate}deg)`,
                        transition: isDragging.value ? 'none' : cardTransition.value
                    };
                });

                const swipeOverlayOpacity = computed(() => {
                    const threshold = 100;
                    const rightOpacity = dragX.value > 0 ? Math.min(dragX.value / threshold, 1) : 0;
                    const leftOpacity = dragX.value < 0 ? Math.min(Math.abs(dragX.value) / threshold, 1) : 0;
                    return { right: rightOpacity, left: leftOpacity };
                });

                onMounted(() => {
                    try {
                        const savedBookmarks = localStorage.getItem('jp_app_bookmarks');
                        if (savedBookmarks) bookmarks.value = JSON.parse(savedBookmarks);
                        const savedMissed = localStorage.getItem('jp_app_missed');
                        if (savedMissed) missedIds.value = JSON.parse(savedMissed);
                        const savedControlMode = localStorage.getItem('jp_app_mobile_control');
                        if (savedControlMode) mobileControlMode.value = savedControlMode;
                    } catch(e) { console.error(e); }
                    window.addEventListener('keydown', handleKeydown);
                });

                onUnmounted(() => {
                    window.removeEventListener('keydown', handleKeydown);
                });

                watch(bookmarks, (newVal) => localStorage.setItem('jp_app_bookmarks', JSON.stringify(newVal)), { deep: true });
                watch(missedIds, (newVal) => localStorage.setItem('jp_app_missed', JSON.stringify(newVal)), { deep: true });
                watch(mobileControlMode, (newVal) => localStorage.setItem('jp_app_mobile_control', newVal));

                const handleKeydown = (e) => {
                    if (activeTab.value === 'flashcards' && !roundComplete.value && currentDeck.value.length > 0 && !showDeckMenu.value) {
                        if (e.code === 'Space') { e.preventDefault(); isFlipped.value = !isFlipped.value; }
                        else if (e.code === 'ArrowUp') { e.preventDefault(); prevCard(); }
                        else if (e.code === 'ArrowDown') { e.preventDefault(); nextCard(); }
                        else if (e.code === 'ArrowLeft') { e.preventDefault(); simulateSwipe('left'); }
                        else if (e.code === 'ArrowRight') { e.preventDefault(); simulateSwipe('right'); }
                    }
                };

                const setActiveTab = (tab) => { activeTab.value = tab; };

                const startSession = (type) => {
                    let deck = [];
                    if (type === 'all') deck = [...vocabularyData];
                    else if (type === 'bookmarks') deck = vocabularyData.filter(item => bookmarks.value.includes(item.id));
                    else if (type === 'missed') deck = vocabularyData.filter(item => missedIds.value.includes(item.id));

                    if (deck.length === 0) return;

                    currentSessionType.value = type;
                    currentDeck.value = deck;
                    currentIndex.value = 0;
                    isFlipped.value = false;
                    roundComplete.value = false;
                    memorizedIds.value = []; 
                    activeTab.value = 'flashcards';
                    // å¼·åˆ¶é‡ç½®æ‹–æ›³ç‹€æ…‹ï¼Œè§£æ±ºåˆå§‹éš±å½¢å•é¡Œ
                    dragX.value = 0;
                };

                const shuffleDeck = () => {
                    const shuffled = [...currentDeck.value].sort(() => 0.5 - Math.random());
                    currentDeck.value = shuffled;
                    currentIndex.value = 0;
                    isFlipped.value = false;
                };

                const handleCardResult = (result) => {
                    const currentCard = currentDeck.value[currentIndex.value];
                    if (result === 'memorized') {
                        if (!memorizedIds.value.includes(currentCard.id)) memorizedIds.value.push(currentCard.id);
                        if (missedIds.value.includes(currentCard.id)) missedIds.value = missedIds.value.filter(id => id !== currentCard.id);
                    } else {
                        if (!missedIds.value.includes(currentCard.id)) missedIds.value.push(currentCard.id);
                    }

                    if (currentIndex.value < currentDeck.value.length - 1) {
                        setTimeout(() => {
                            isFlipped.value = false;
                            dragX.value = 0;
                            currentIndex.value++;
                        }, 200);
                    } else {
                        roundComplete.value = true;
                    }
                };

                const nextCard = () => {
                    if (currentIndex.value < currentDeck.value.length - 1) {
                        isFlipped.value = false;
                        currentIndex.value++;
                    }
                };

                const prevCard = () => {
                    if (currentIndex.value > 0) {
                        isFlipped.value = false;
                        currentIndex.value--;
                    }
                };

                const toggleBookmark = (id) => {
                    if (bookmarks.value.includes(id)) bookmarks.value = bookmarks.value.filter(bid => bid !== id);
                    else bookmarks.value.push(id);
                };

                const hasBookmark = (id) => bookmarks.value.includes(id);
                const toggleFlashcardMode = () => { flashcardMode.value = flashcardMode.value === 'jp-zh' ? 'zh-jp' : 'jp-zh'; };

                const handleCardClick = () => {
                    if (!isDragging.value) {
                         isFlipped.value = !isFlipped.value;
                    }
                };

                let startX = 0;

                const onTouchStart = (e) => {
                    if(e.target.closest('button')) return;
                    isDragging.value = true;
                    dragX.value = 0; 
                    startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    cardTransition.value = 'none';
                };

                const onTouchMove = (e) => {
                    if (!isDragging.value) return;
                    const currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    dragX.value = currentX - startX;
                };

                const onTouchEnd = (e) => {
                    if (!isDragging.value) return;
                    isDragging.value = false;
                    cardTransition.value = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';

                    const threshold = 80;
                    if (Math.abs(dragX.value) < 10) {
                        dragX.value = 0;
                        return;
                    }

                    if (dragX.value > threshold) {
                        dragX.value = window.innerWidth;
                        handleCardResult('memorized');
                    } else if (dragX.value < -threshold) {
                        dragX.value = -window.innerWidth;
                        handleCardResult('missed');
                    } else {
                        dragX.value = 0;
                    }
                };

                const simulateSwipe = (direction) => {
                    cardTransition.value = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    if (direction === 'right') {
                        dragX.value = window.innerWidth;
                        handleCardResult('memorized');
                    } else {
                        dragX.value = -window.innerWidth;
                        handleCardResult('missed');
                    }
                };

                const startQuiz = () => {
                    let pool = [];
                    if (quizConfig.value.source === 'bookmarks') pool = vocabularyData.filter(item => bookmarks.value.includes(item.id));
                    else if (quizConfig.value.source === 'missed') pool = vocabularyData.filter(item => missedIds.value.includes(item.id));
                    else pool = [...vocabularyData];
                    pool = pool.sort(() => 0.5 - Math.random());
                    if (quizConfig.value.count !== 'all') pool = pool.slice(0, quizConfig.value.count);
                    if (pool.length === 0) { alert('é¸å®šçš„ç¯„åœæ²’æœ‰é¡Œç›®ï¼'); return; }
                    quizState.value = { questions: pool, currentQIndex: 0, score: 0, lastCorrect: null, options: generateOptions(pool[0]) };
                    quizPhase.value = 'playing';
                };

                const generateOptions = (correctItem) => {
                    const incorrect = vocabularyData.filter(item => item.id !== correctItem.id).sort(() => 0.5 - Math.random()).slice(0, 3);
                    return [correctItem, ...incorrect].sort(() => 0.5 - Math.random());
                };

                const handleQuizAnswer = (selectedOption) => {
                    if (quizState.value.lastCorrect !== null) return;
                    const currentQ = quizState.value.questions[quizState.value.currentQIndex];
                    let isCorrect = quizConfig.value.mode === 'jp-zh' ? selectedOption.meaning === currentQ.meaning : selectedOption.word === currentQ.word;
                    quizState.value.lastCorrect = isCorrect;
                    if (isCorrect) {
                        quizState.value.score++;
                        if (missedIds.value.includes(currentQ.id)) missedIds.value = missedIds.value.filter(id => id !== currentQ.id);
                    } else {
                        if (!missedIds.value.includes(currentQ.id)) missedIds.value.push(currentQ.id);
                    }
                    setTimeout(() => {
                        if (quizState.value.currentQIndex + 1 < quizState.value.questions.length) {
                            quizState.value.currentQIndex++;
                            quizState.value.lastCorrect = null;
                            quizState.value.options = generateOptions(quizState.value.questions[quizState.value.currentQIndex]);
                        } else {
                            quizPhase.value = 'result';
                        }
                    }, 1000);
                };

                const getQuizOptionClass = (opt) => {
                    if (quizState.value.lastCorrect === null) return 'bg-white border-slate-100 active:bg-indigo-50 hover:border-indigo-200';
                    const currentQ = quizState.value.questions[quizState.value.currentQIndex];
                    const isCorrect = quizConfig.value.mode === 'jp-zh' ? opt.meaning === currentQ.meaning : opt.word === currentQ.word;
                    if (isCorrect) return 'border-green-500 bg-green-50 text-green-700';
                    if (quizState.value.lastCorrect === false && !isCorrect) return 'opacity-40 border-slate-100';
                    return 'bg-white border-slate-100';
                };

                return {
                    vocabularyData, activeTab, setActiveTab,
                    listFilterMode, mobileControlMode, // æ–°å¢
                    currentDeck, currentIndex, isFlipped, flashcardMode, currentItem, 
                    memorizedIds, missedIds, bookmarks, roundComplete, sessionLearnedCount,
                    startSession, shuffleDeck, handleCardResult, toggleBookmark, hasBookmark, toggleFlashcardMode,
                    nextCard, prevCard, handleCardClick,
                    onTouchStart, onTouchMove, onTouchEnd, dragX, cardContainerStyle, swipeOverlayOpacity,
                    groupedData, quizPhase, quizConfig, quizState, currentQuizItem, quizPercentage,
                    startQuiz, handleQuizAnswer, getQuizOptionClass,
                    showDeckMenu, currentSessionType
                };
            }
        }); 

        app.mount('#app');
    </script>
</body>
</html>
