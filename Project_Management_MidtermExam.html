<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¡ˆç®¡ç†æœŸä¸­å‚™è€ƒç³»çµ± V18.0 (å®Œå…¨æ•´åˆç‰ˆ)</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --secondary: #1e40af;
            --accent: #f59e0b;
            --bg-main: #f8fafc;
            --bg-sidebar: #ffffff;
            --text-main: #334155;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --mask-bg: #cbd5e1;
            --sidebar-width: 280px;
            --success: #10b981;
            --fail: #ef4444;
            --term-highlight: #8b5cf6;
            --section-header-bg: #e0f2fe;
            --card-front: #ffffff;
            --card-back: #f0f9ff;
        }
        body.dark-mode {
            --primary: #60a5fa;
            --primary-light: #1e293b;
            --secondary: #93c5fd;
            --accent: #fbbf24;
            --bg-main: #0f172a;
            --bg-sidebar: #1e293b;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #334155;
            --mask-bg: #475569;
            --term-highlight: #a78bfa;
            --section-header-bg: #075985;
            --card-front: #1e293b;
            --card-back: #334155;
        }
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Segoe UI', "Microsoft JhengHei", sans-serif;
            line-height: 1.75;
            color: var(--text-main);
            background-color: var(--bg-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        #progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: var(--accent); width: 0%; z-index: 1002; transition: width 0.2s; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background: var(--bg-sidebar);
            border-right: 1px solid var(--border); display: flex; flex-direction: column;
            height: 100vh; position: fixed; z-index: 100; transition: transform 0.3s ease-in-out;
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-header h3 { margin: 0; color: var(--primary); font-size: 1.3em; }
        .shortcuts-hint { font-size: 0.75em; color: var(--text-muted); margin-top: 5px; }
        .search-box { margin-top: 15px; position: relative; }
        .search-box input {
            width: 100%; padding: 10px 35px 10px 12px; border: 2px solid var(--border);
            border-radius: 8px; background: var(--bg-main); color: var(--text-main); outline: none;
        }
        .search-box::after { content: 'ğŸ”'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: 15px; }
        .nav-link {
            display: flex; align-items: center; padding: 8px 12px; color: var(--text-main);
            text-decoration: none; border-radius: 8px; margin-bottom: 4px; font-size: 0.95em; transition: all 0.2s;
        }
        .nav-link:hover, .nav-link.active { background-color: var(--primary-light); color: var(--primary); font-weight: 600; }
        .progress-dot {
            width: 8px; height: 8px; border-radius: 50%; background: var(--border);
            margin-right: 10px; flex-shrink: 0; transition: background 0.3s;
        }
        .nav-link.mastered .progress-dot { background: var(--success); }
        .sidebar-footer { padding: 15px; border-top: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .tool-btn {
            padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
            transition: 0.2s; font-size: 0.9em; display: flex; align-items: center; justify-content: center; gap: 6px;
            background: var(--bg-main); color: var(--text-main); border: 1px solid var(--border);
        }
        .tool-btn:hover { background: var(--primary-light); }
        #btn-dark { grid-column: 1 / -1; }
        #btn-vocab { background: var(--primary); color: white; border: none; }
        #btn-vocab:hover { background: var(--secondary); }
        #btn-flashcard { background: var(--accent); color: white; border: none; }
        #btn-flashcard:hover { filter: brightness(0.9); }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width); flex: 1; padding: 40px 60px;
            overflow-y: auto; scroll-behavior: smooth; height: 100vh;
        }
        h1 { color: var(--primary); text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: var(--text-muted); margin-bottom: 50px; }
        h2 {
            background: linear-gradient(135deg, var(--secondary), var(--primary)); color: white;
            padding: 15px 25px; border-radius: 12px; margin: 60px 0 30px 0;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
        }
        .section-block {
            background: var(--bg-sidebar); padding: 30px; border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid var(--border);
            margin-bottom: 35px; transition: all 0.3s;
        }
        .section-block.mastered { opacity: 0.6; filter: grayscale(0.8); }
        .section-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--primary-light);
        }
        .section-header h3 { margin: 0; color: var(--secondary); font-size: 1.4em; }
        .master-check {
            cursor: pointer; display: flex; align-items: center; gap: 8px; color: var(--text-muted);
            padding: 6px 12px; border-radius: 20px; border: 2px solid var(--border); font-weight: 600;
            font-size: 0.9em; transition: all 0.2s;
        }
        .master-check.checked { background: var(--success); color: white; border-color: var(--success); }

        /* Note & Interactive Elements */
        .note-area { margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--border); }
        .note-toggle { background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-weight: 600; }
        .my-note {
            width: 100%; min-height: 80px; margin-top: 10px; padding: 12px;
            border: 2px solid var(--border); border-radius: 10px;
            background: var(--bg-main); color: var(--text-main);
            display: none;
        }
        .term { color: var(--term-highlight); font-weight: 600; border-bottom: 2px dashed var(--term-highlight); cursor: help; }
        .quiz-mask { border-bottom: 2px dotted var(--text-muted); cursor: default; padding: 0 2px; }
        body.quiz-mode .quiz-mask { background-color: var(--mask-bg) !important; color: transparent !important; border-radius: 4px; cursor: pointer; }
        body.quiz-mode .quiz-mask.revealed { background-color: transparent !important; color: inherit !important; border-bottom: 2px solid var(--success); animation: pop 0.3s ease-out; }
        @keyframes pop { 50% { transform: scale(1.15); } }
        .highlight-box { background: var(--primary-light); border-left: 5px solid var(--primary); padding: 20px; border-radius: 0 12px 12px 0; margin: 25px 0; }
        .exam-tip { background: #fffbeb; border: 2px solid var(--accent); color: #92400e; padding: 15px 20px; border-radius: 12px; margin: 25px 0; display: flex; gap: 15px; }
        .exam-tip::before { content: 'ğŸ’¡'; font-size: 1.5em; }
        body.dark-mode .exam-tip { background: #451a03; color: #fcd34d; }

        /* Tables */
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin: 25px 0; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); }
        th, td { padding: 12px 15px; border-bottom: 1px solid var(--border); border-right: 1px solid var(--border); vertical-align: top; }
        th { background: var(--primary-light); color: var(--secondary); font-weight: 700; }
        #sec0 th { background: var(--section-header-bg); text-align: center; }
        #sec0 td:nth-child(2) { font-weight: 600; text-align: center; width: 15%; }

        /* Modals & Floating Buttons */
        .fab-container { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 90; }
        .fab { width: 56px; height: 56px; border-radius: 50%; border: none; color: white; font-size: 1.5em; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .fab:hover { transform: scale(1.1); }
        #quiz-fab { background: var(--primary); }
        body.quiz-mode #quiz-fab { background: var(--accent); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0); } 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); } }
        #top-fab { background: var(--text-muted); opacity: 0; pointer-events: none; }
        #top-fab.visible { opacity: 0.8; pointer-events: auto; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7);
            z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background: var(--bg-sidebar); padding: 30px; border-radius: 24px; width: 90%; max-width: 600px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); position: relative; max-height: 90vh; overflow-y: auto;
        }
        .close-modal { position: absolute; top: 20px; right: 20px; border: none; background: transparent; font-size: 2em; color: var(--text-muted); cursor: pointer; line-height: 1; z-index: 10; }

        /* --- VOCAB CARD SPECIFIC STYLES --- */
        #vocab-modal .modal-content { max-width: 500px; background: transparent; box-shadow: none; padding: 0; }
        .card-container {
            width: 100%; height: 350px; perspective: 1000px; margin-bottom: 20px;
        }
        .card-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s; transform-style: preserve-3d;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); border-radius: 20px; cursor: pointer;
        }
        .card-container.flipped .card-inner { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; border-radius: 20px; background: var(--card-front); border: 2px solid var(--border);
        }
        .card-front { font-size: 2em; font-weight: bold; color: var(--primary); }
        .card-back { background: var(--card-back); transform: rotateY(180deg); text-align: left; align-items: flex-start; overflow-y: auto; }
        .card-back h3 { color: var(--secondary); margin-top: 0; border-bottom: 2px solid var(--accent); padding-bottom: 10px; width: 100%; }
        .vocab-actions { display: flex; gap: 10px; }
        .vocab-btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: 0.2s; color: white; }
        #btn-know { background: var(--success); } #btn-know:hover { filter: brightness(0.9); }
        #btn-dont-know { background: var(--fail); } #btn-dont-know:hover { filter: brightness(0.9); }
        .vocab-progress { text-align: center; color: white; margin-top: 15px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .vocab-filter { margin-top: 15px; padding: 8px; border-radius: 8px; border: none; width: 100%; font-size: 1em; }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-105%); } .sidebar.open { transform: translateX(0); box-shadow: 100px 0 0 rgba(0,0,0,0.5); }
            .main-content { margin-left: 0; padding: 20px 15px 100px 15px; }
            #menu-toggle { display: block !important; position: fixed; top: 15px; left: 15px; z-index: 101; background: var(--bg-sidebar); padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        }
    </style>
</head>
<body>

    <div id="progress-bar"></div>
    <button id="menu-toggle" style="display:none;">â˜°</button>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>ğŸš€ å‚™è€ƒç³»çµ± V18.0</h3>
            <div class="shortcuts-hint">å®Œå…¨æ•´åˆç‰ˆ (Integrated)</div>
            <div class="search-box"><input type="text" id="search-input" placeholder="æœå°‹ç­†è¨˜..."></div>
        </div>
        <div class="sidebar-nav">
            <a href="#sec0" class="nav-link" style="color: #ef4444; font-weight: bold;">ğŸ“– å°ˆæœ‰åè©ç¸½è¡¨ (Ch 1-4)</a>
            <a href="#sec1" class="nav-link">ğŸ¯ åŸºç¤æ¶æ§‹ (Foundations)</a>
            <a href="#sec1-1" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec1-1"></span>æ ¸å¿ƒå®šç¾©èˆ‡ç‰¹æ€§</a>
            <a href="#sec1-2" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec1-2"></span>ç’°å¢ƒã€çµ„ç¹”èˆ‡ PMO</a>
            <a href="#sec1-3" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec1-3"></span>PMBOK äº”å¤§æµç¨‹</a>
            <a href="#sec1-4" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec1-4"></span>åå¤§çŸ¥è­˜é ˜åŸŸ (KA)</a>
            <a href="#sec1-5" class="nav-link" style="padding-left: 25px; color: var(--primary); font-weight: bold;"><span class="progress-dot" data-target="sec1-5"></span>PM è§’è‰²èˆ‡è·è²¬</a>
            <a href="#sec2" class="nav-link">ğŸ§­ èµ·å§‹æµç¨‹ (Initiating)</a>
            <a href="#sec2-1" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec2-1"></span>å°ˆæ¡ˆé¸æ“‡æ¨¡å‹</a>
            <a href="#sec2-2" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec2-2"></span>å°ˆæ¡ˆç« ç¨‹ (è©³)</a>
            <a href="#sec2-3" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec2-3"></span>åˆ©å®³é—œä¿‚äºº</a>
            <a href="#sec3" class="nav-link">ğŸ§± è¦åŠƒæµç¨‹ (Planning)</a>
            <a href="#sec3-1" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec3-1"></span>è¨ˆç•«æ›¸èˆ‡åŸºæº– (è©³)</a>
            <a href="#sec3-2" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec3-2"></span>ç¯„ç–‡ç®¡ç† (WBS)</a>
            <a href="#sec3-3" class="nav-link" style="padding-left: 25px;"><span class="progress-dot" data-target="sec3-3"></span>è²¬ä»»èˆ‡æºé€š (è©³)</a>
            <a href="#sec4" class="nav-link" style="color: var(--accent); font-weight: bold;">ğŸƒ æ•æ·ç®¡ç† (Agile)</a>
        </div>
        <div class="sidebar-footer">
            <button id="btn-dark" class="tool-btn">ğŸŒ™ å¤œé–“æ¨¡å¼</button>
            <button id="btn-flashcard" class="tool-btn">ğŸ² éš¨æ©Ÿå…‹æ¼å­—</button>
            <button id="btn-vocab" class="tool-btn">ğŸ´ æ ¸å¿ƒå–®å­—å¡</button>
        </div>
    </nav>

    <main class="main-content" id="main-scroll">
        <h1>ğŸ“˜ å°ˆæ¡ˆç®¡ç†æœŸä¸­è€ƒçµ‚æ¥µç­†è¨˜</h1>
        <p class="subtitle">é»æ“Š<span class="term" data-term="demo">ç´«è‰²åè©</span>æŸ¥çœ‹è©³ç´°è§£é‡‹ | [Q]éµåˆ‡æ›èƒŒèª¦æ¨¡å¼</p>

        <section id="sec0">
            <h2>ğŸ“– å°ˆæœ‰åè©ç¸½è¡¨ (Ch 1-4)</h2>
            <div id="sec0-1" class="section-block">
                <div class="section-header"><h3>å£¹ã€å°ˆæ¡ˆèˆ‡çµ„ç¹”æ ¸å¿ƒæ¦‚å¿µ</h3><div class="master-check" data-id="sec0-1"><span>â˜</span> æˆ‘å·²æŒæ¡</div></div>
                <table>
                    <thead><tr><th>å°ˆæœ‰åè©</th><th>åˆ†é¡</th><th>è§£é‡‹</th><th>é—œéµç´°ç¯€</th></tr></thead>
                    <tbody>
                        <tr><td><span class="term" data-term="project">å°ˆæ¡ˆ</span></td><td>æ ¸å¿ƒå®šç¾©</td><td>å‰µé€ ç¨ç‰¹ç”¢å“/æœå‹™çš„æš«æ™‚æ€§å·¥ä½œã€‚</td><td>å…·å‚™ã€Œ<span class="quiz-mask">æš«æ™‚æ€§</span>ã€èˆ‡ã€Œ<span class="quiz-mask">ç¨ç‰¹æ€§</span>ã€ã€‚</td></tr>
                        <tr><td><span class="term" data-term="vuca">VUCA</span></td><td>ç’°å¢ƒ</td><td>æè¿°ç¾ä»£å•†æ¥­ç’°å¢ƒçš„å››å€‹ç‰¹å¾µã€‚</td><td>æ˜“è®Šã€ä¸ç¢ºå®šã€è¤‡é›œã€æ¨¡ç³Šã€‚</td></tr>
                        <tr><td><span class="term" data-term="pmbok">PMBOK Guide</span></td><td>æ¨™æº–</td><td>å°ˆæ¡ˆç®¡ç†çŸ¥è­˜é«”ç³»æŒ‡å—ã€‚</td><td>å…¨çƒå°ˆæ¡ˆç®¡ç†çš„å…±åŒèªè¨€ã€‚</td></tr>
                    </tbody>
                </table>
                <div class="section-header"><h3>è²³ã€å°ˆæ¡ˆç’°å¢ƒèˆ‡çµ„ç¹”çµæ§‹</h3><div class="master-check" data-id="sec0-2"><span>â˜</span> æˆ‘å·²æŒæ¡</div></div>
                <table>
                    <thead><tr><th>å°ˆæœ‰åè©</th><th>åˆ†é¡</th><th>è§£é‡‹</th><th>é—œéµç´°ç¯€</th></tr></thead>
                    <tbody>
                        <tr><td><span class="term" data-term="eef">EEF</span></td><td>å¤–éƒ¨ç’°å¢ƒ</td><td>åœ˜éšŠç„¡æ³•æ§åˆ¶çš„ç’°å¢ƒæ¢ä»¶ã€‚</td><td>æ˜¯<span class="quiz-mask">é™åˆ¶</span>ã€‚</td></tr>
                        <tr><td><span class="term" data-term="opa">OPA</span></td><td>å…§éƒ¨è³‡æº</td><td>åœ˜éšŠå¯åˆ©ç”¨çš„å…§éƒ¨è³‡ç”¢(æµç¨‹/çŸ¥è­˜åº«)ã€‚</td><td>æ˜¯<span class="quiz-mask">å·¥å…·</span>ã€‚</td></tr>
                        <tr><td><span class="term" data-term="functional_org">åŠŸèƒ½å‹çµ„ç¹”</span></td><td>çµæ§‹</td><td>å‚³çµ±éƒ¨é–€åŒ–ï¼ŒPM æ¬ŠåŠ›<span class="quiz-mask">æ¥µä½</span>ã€‚</td><td>è³‡æºç”±åŠŸèƒ½ç¶“ç†æ§åˆ¶ã€‚</td></tr>
                        <tr><td><span class="term" data-term="projectized_org">å°ˆæ¡ˆå‹çµ„ç¹”</span></td><td>çµæ§‹</td><td>åœç¹å°ˆæ¡ˆé‹ä½œï¼ŒPM æ¬ŠåŠ›<span class="quiz-mask">æ¥µé«˜</span>ã€‚</td><td>è³‡æºç¨å ã€‚</td></tr>
                        <tr><td><span class="term" data-term="pmo">PMO</span></td><td>å–®ä½</td><td>è² è²¬é›†ä¸­ç®¡ç†å’Œæ¨™æº–åŒ–ã€‚</td><td>åˆ†æ”¯æ´ã€ç®¡åˆ¶ã€æŒ‡ä»¤å‹ã€‚</td></tr>
                    </tbody>
                </table>
                <div class="note-area"><button class="note-toggle">æ·»åŠ ç­†è¨˜</button><textarea class="my-note"></textarea></div>
            </div>
        </section>

        <section id="sec1">
            <h2>ğŸ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šå°ˆæ¡ˆç®¡ç†åŸºç¤æ¶æ§‹</h2>
            <div id="sec1-1" class="section-block">
                <div class="section-header"><h3>å£¹ã€æ ¸å¿ƒå®šç¾©èˆ‡ç‰¹æ€§</h3><div class="master-check" data-id="sec1-1"><span>â˜</span> æˆ‘å·²æŒæ¡</div></div>
                <div class="content-body">
                    <p><strong>å°ˆæ¡ˆ (Project)ï¼š</strong>ç‚ºå‰µé€ <span class="quiz-mask">ç¨ä¸€ç„¡äºŒ</span>çš„ç”¢å“ã€æœå‹™æˆ–æˆæœï¼Œè€Œå¾äº‹çš„<span class="quiz-mask">æš«æ™‚æ€§</span>åŠªåŠ›ã€‚</p>
                    <ul>
                        <li><strong>æš«æ™‚æ€§ï¼š</strong>æœ‰æ˜ç¢ºèµ·è¨–ï¼Œéæ°¸ä¹…æŒçºŒã€‚</li>
                        <li><strong><span class="term" data-term="progressive_elaboration">é€æ­¥å®Œå–„</span>ï¼š</strong>éš¨è³‡è¨Šæ˜æœ—ï¼Œè¨ˆç•«ç”±ç²—åˆ°ç´°çš„éç¨‹ã€‚</li>
                    </ul>
                </div>
            </div>
             </section>

    </main>

    <div class="fab-container">
        <button id="top-fab" class="fab" title="å›åˆ°é ‚ç«¯">â¬†</button>
        <button id="quiz-fab" class="fab" title="åˆ‡æ›èƒŒèª¦æ¨¡å¼ (Q)">ğŸ›¡ï¸</button>
    </div>

    <div class="modal-overlay" id="glossary-modal">
        <div class="modal-content" style="background: var(--bg-sidebar);">
            <button class="close-modal" onclick="closeModal('glossary-modal')">Ã—</button>
            <div style="border-bottom: 2px solid var(--term-highlight); margin-bottom: 15px; padding-bottom: 10px;">
                <span style="font-size:2em;">ğŸ“–</span><h3 id="glossary-title" style="display:inline; margin-left:10px; color:var(--term-highlight);"></h3>
            </div>
            <div style="font-weight:bold; color:var(--text-muted);">å®šç¾©</div><div id="glossary-def" style="font-size:1.1em; margin-bottom:15px;"></div>
            <div style="font-weight:bold; color:var(--accent);">å¯¦å‹™/è€ƒè©¦é‡é»</div><div id="glossary-app" style="font-size:1.1em;"></div>
        </div>
    </div>

    <div class="modal-overlay" id="flashcard-modal">
        <div class="modal-content" style="text-align: center; background: var(--bg-sidebar);">
            <button class="close-modal" onclick="closeModal('flashcard-modal')">Ã—</button>
            <h3 style="color:var(--primary);">ğŸ² éš¨æ©Ÿå…‹æ¼å­—</h3><p style="color:var(--text-muted);" id="flash-context"></p>
            <div id="flash-q" style="font-size:1.3em;margin:30px 0;min-height:60px; line-height:1.6; text-align:left; background:var(--bg-main); padding:20px; border-radius:12px;"></div>
            <div id="flash-a" style="font-size:1.5em;color:var(--success);font-weight:bold;padding:20px;background:var(--primary-light);border-radius:12px;display:none;"></div>
            <button id="flash-reveal" class="tool-btn" style="width:100%;background:var(--primary);color:#fff;padding:15px;margin-top:20px;border:none;">çœ‹ç­”æ¡ˆ</button>
            <button id="flash-next" class="tool-btn" style="width:100%;background:var(--accent);color:#fff;padding:15px;margin-top:10px;display:none;border:none;">ä¸‹ä¸€é¡Œ â†’</button>
        </div>
    </div>

    <div class="modal-overlay" id="vocab-modal">
        <div class="modal-content" style="background: transparent; box-shadow: none; max-width: 500px;">
            <button class="close-modal" onclick="closeModal('vocab-modal')" style="color: white; top: -40px; right: 0;">Ã—</button>
            
            <select id="vocab-filter" class="vocab-filter">
                <option value="all">ğŸ” å…¨éƒ¨å–®å­—å¡</option>
                <option value="unmastered" selected>ğŸ”¥ åƒ…è¤‡ç¿’ä¸ç†Ÿæ‚‰</option>
            </select>

            <div class="card-container" id="vocab-card-container">
                <div class="card-inner">
                    <div class="card-face card-front" id="vocab-front">æ­£é¢</div>
                    <div class="card-face card-back">
                        <h3 id="vocab-back-title">æ¨™é¡Œ</h3>
                        <div id="vocab-back-content">å…§å®¹</div>
                    </div>
                </div>
            </div>

            <div class="vocab-actions">
                <button id="btn-dont-know" class="vocab-btn">â“ ä¸ç†Ÿ</button>
                <button id="btn-know" class="vocab-btn">âœ… è¨˜ä½äº†</button>
            </div>
            <div class="vocab-progress">
                é€²åº¦: <span id="vocab-current">0</span> / <span id="vocab-total">0</span> (å·²æŒæ¡: <span id="vocab-mastered">0</span>)
            </div>
        </div>
    </div>

    <script>
        // === 1. DATA ===
        const glossaryDB = {
            "demo": { title: "åŠŸèƒ½ç¤ºç¯„", def: "é»æ“Šç´«è‰²åè©å¯æŸ¥çœ‹è§£é‡‹ã€‚", app: "éš¨é»éš¨æŸ¥ï¼Œä¸ä¸­æ–·æ€ç·’ã€‚" },
            "project": { title: "å°ˆæ¡ˆ (Project)", def: "ç‚ºå‰µé€ ç¨ç‰¹ç”¢å“/æœå‹™è€Œé€²è¡Œçš„æš«æ™‚æ€§å·¥ä½œã€‚", app: "æ ¸å¿ƒç‰¹æ€§ï¼šæš«æ™‚æ€§ã€ç¨ç‰¹æ€§ã€‚" },
            // ... (è«‹å°‡ V16.0 ä¸­å®Œæ•´çš„ glossaryDB è²¼åˆ°é€™è£¡ï¼ŒåŒ…å«æ‰€æœ‰ 40+ å€‹åè©) ...
            "pmbok": { title: "PMBOKÂ® Guide", def: "å°ˆæ¡ˆç®¡ç†çŸ¥è­˜é«”ç³»æŒ‡å— (PMI ç™¼å¸ƒ)ã€‚", app: "å…¨çƒå°ˆæ¡ˆç®¡ç†çš„å…±åŒèªè¨€ã€‚" },
            "vuca": { title: "VUCA", def: "æ˜“è®Šæ€§ã€ä¸ç¢ºå®šæ€§ã€è¤‡é›œæ€§ã€æ¨¡ç³Šæ€§ã€‚", app: "ç¾ä»£ç’°å¢ƒç‰¹å¾µï¼Œéœ€æ•æ·æ‡‰å°ã€‚" },
            "eef": { title: "ä¼æ¥­ç’°å¢ƒå› ç´  (EEF)", def: "åœ˜éšŠç„¡æ³•æ§åˆ¶çš„å¤–éƒ¨ç’°å¢ƒæ¢ä»¶ã€‚", app: "æ˜¯ã€Œé™åˆ¶ã€ã€‚" },
            "opa": { title: "çµ„ç¹”æµç¨‹è³‡ç”¢ (OPA)", def: "åœ˜éšŠå¯åˆ©ç”¨çš„å…§éƒ¨è³‡ç”¢(æµç¨‹/çŸ¥è­˜åº«)ã€‚", app: "æ˜¯ã€Œå·¥å…·ã€ã€‚" },
             // ... å‹™å¿…å®Œæ•´å¡«å…¥ ...
        };

        // Transform glossaryDB into an array for the flashcard system
        const VOCAB_DECK = Object.values(glossaryDB).map(item => ({
            term: item.title,
            def: `<strong>å®šç¾©ï¼š</strong>${item.def}<br><br><strong>é‡é»ï¼š</strong>${item.app}`
        }));

        // === 2. CORE APP STATE ===
        const STORAGE_KEY = 'pm_v18_data';
        let appData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"progress":{}, "notes":{}, "dark":false, "vocabMastery":{}}');
        
        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); }

        // === 3. UI INITIALIZATION ===
        if (appData.dark) document.body.classList.add('dark-mode');
        Object.keys(appData.progress).forEach(id => {
             const sec = document.getElementById(id);
             if (sec) {
                 sec.classList.toggle('mastered', appData.progress[id]);
                 sec.querySelector('.master-check').innerHTML = appData.progress[id] ? '<span>â˜‘</span> å·²æŒæ¡' : '<span>â˜</span> æˆ‘å·²æŒæ¡';
                 const dot = document.querySelector(`.progress-dot[data-target="${id}"]`);
                 if(dot) dot.parentElement.classList.toggle('mastered', appData.progress[id]);
             }
        });
        document.querySelectorAll('.my-note').forEach(el => {
            const id = el.closest('.section-block').id;
            if(appData.notes[id]) { el.value = appData.notes[id]; el.style.display = 'block'; }
        });

        // === 4. EVENT LISTENERS (General) ===
        document.getElementById('btn-dark').addEventListener('click', () => { 
            appData.dark = !appData.dark; document.body.classList.toggle('dark-mode', appData.dark); saveData(); 
        });
        document.getElementById('quiz-fab').addEventListener('click', () => document.body.classList.toggle('quiz-mode'));
        document.body.addEventListener('click', e => {
            if(document.body.classList.contains('quiz-mode') && e.target.classList.contains('quiz-mask')) {
                e.target.classList.add('revealed');
            }
        });
        document.querySelectorAll('.master-check').forEach(btn => btn.addEventListener('click', e => {
            const id = btn.dataset.id; appData.progress[id] = !appData.progress[id];
            e.currentTarget.closest('.section-block').classList.toggle('mastered', appData.progress[id]);
            e.currentTarget.innerHTML = appData.progress[id] ? '<span>â˜‘</span> å·²æŒæ¡' : '<span>â˜</span> æˆ‘å·²æŒæ¡';
            saveData(); e.stopPropagation();
        }));
        document.querySelectorAll('.note-toggle').forEach(b => b.addEventListener('click', e => {
            const a = e.target.nextElementSibling; a.style.display = a.style.display==='block'?'none':'block'; if(a.style.display==='block') a.focus();
        }));
        document.querySelectorAll('.my-note').forEach(el => el.addEventListener('input', e => {
            appData.notes[el.closest('.section-block').id] = e.target.value; saveData();
        }));

        // Glossary Click
        document.body.addEventListener('click', e => {
            const t = e.target.closest('.term');
            if(t && glossaryDB[t.dataset.term]) {
                const d = glossaryDB[t.dataset.term];
                document.getElementById('glossary-title').textContent = d.title;
                document.getElementById('glossary-def').textContent = d.def;
                document.getElementById('glossary-app').textContent = d.app;
                openModal('glossary-modal');
            }
        });

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        // === 5. CLOZE FLASHCARD SYSTEM (èˆŠçš„éš¨æ©ŸæŠ½é¡Œ) ===
        let clozeCards = [];
        window.addEventListener('load', () => {
             document.querySelectorAll('.section-block').forEach(section => {
                section.querySelectorAll('.quiz-mask').forEach(originalMask => {
                    if (!originalMask.innerText.trim()) return;
                    let container = originalMask.closest('tr') || originalMask.closest('li') || originalMask.closest('p') || originalMask.closest('.exam-tip') || originalMask.closest('.highlight-box');
                    if (!container) container = originalMask.parentElement;
                    if (container) {
                        let allMasks = Array.from(container.querySelectorAll('.quiz-mask'));
                        let maskIndex = allMasks.indexOf(originalMask);
                        let clone = container.cloneNode(true);
                        if (container.tagName === 'TR') { let w = document.createElement('table'); w.appendChild(clone); clone = w; }
                        let cloneMasks = clone.querySelectorAll('.quiz-mask');
                        if(cloneMasks[maskIndex]) cloneMasks[maskIndex].innerHTML = '<span style="color:var(--accent);border-bottom:3px solid var(--accent);font-weight:900;padding:2px 8px;background:#fffbeb;border-radius:4px;">ã€â“â“â“ã€‘</span>';
                        clozeCards.push({ q: clone.outerHTML || clone.innerHTML, a: originalMask.innerText, src: section.querySelector('h3')?.innerText.trim() });
                    }
                });
            });
        });
        document.getElementById('btn-flashcard').addEventListener('click', () => {
            if(!clozeCards.length) return alert('ç„¡é¡Œç›®');
            const c = clozeCards[Math.floor(Math.random()*clozeCards.length)];
            document.getElementById('flash-q').innerHTML=c.q;
            document.getElementById('flash-a').innerText=c.a;
            document.getElementById('flash-context').innerText=`å‡ºè™•ï¼š${c.src}`;
            document.getElementById('flash-a').style.display='none';
            document.getElementById('flash-reveal').style.display='block';
            document.getElementById('flash-next').style.display='none';
            openModal('flashcard-modal');
        });
        document.getElementById('flash-reveal').addEventListener('click', function() {
            document.getElementById('flash-a').style.display='block'; this.style.display='none'; document.getElementById('flash-next').style.display='block';
        });
        document.getElementById('flash-next').addEventListener('click', () => document.getElementById('btn-flashcard').click());

        // === 6. NEW VOCAB CARD SYSTEM (å–®å­—å¡) ===
        let vocabDeck = [], currentVocabIndex = 0;
        function initVocabDeck() {
            const filter = document.getElementById('vocab-filter').value;
            vocabDeck = VOCAB_DECK.map((c, i) => ({...c, id: i})); // Add original ID
            if (filter === 'unmastered') vocabDeck = vocabDeck.filter(c => !appData.vocabMastery[c.id]);
            if (vocabDeck.length === 0 && VOCAB_DECK.length > 0) {
                alert("æ­å–œï¼æ­¤ç¯©é¸æ¢ä»¶ä¸‹æ²’æœ‰å¡ç‰‡äº†ï¼");
                vocabDeck = VOCAB_DECK.map((c, i) => ({...c, id: i})); // Fallback
            }
            shuffle(vocabDeck);
            currentVocabIndex = 0;
            updateVocabCard();
        }
        function updateVocabCard() {
            if (!vocabDeck.length) return;
            const card = vocabDeck[currentVocabIndex];
            document.getElementById('vocab-front').textContent = card.term;
            document.getElementById('vocab-back-title').textContent = card.term;
            document.getElementById('vocab-back-content').innerHTML = card.def;
            document.getElementById('vocab-card-container').classList.remove('flipped');
            
            document.getElementById('vocab-current').textContent = currentVocabIndex + 1;
            document.getElementById('vocab-total').textContent = vocabDeck.length;
            document.getElementById('vocab-mastered').textContent = Object.values(appData.vocabMastery).filter(v=>v).length;
        }
        document.getElementById('btn-vocab').addEventListener('click', () => { initVocabDeck(); openModal('vocab-modal'); });
        document.getElementById('vocab-card-container').addEventListener('click', function() { this.classList.toggle('flipped'); });
        document.getElementById('vocab-filter').addEventListener('change', initVocabDeck);
        
        function markVocab(mastered) {
            if (!vocabDeck.length) return;
            appData.vocabMastery[vocabDeck[currentVocabIndex].id] = mastered;
            saveData();
            currentVocabIndex = (currentVocabIndex + 1) % vocabDeck.length;
            if (document.getElementById('vocab-filter').value === 'unmastered' && mastered) {
                initVocabDeck(); // Remove mastered card from current deck
            } else {
                updateVocabCard();
            }
        }
        document.getElementById('btn-know').addEventListener('click', (e) => { e.stopPropagation(); markVocab(true); });
        document.getElementById('btn-dont-know').addEventListener('click', (e) => { e.stopPropagation(); markVocab(false); });

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Mobile Menu & Scroll
        document.getElementById('menu-toggle').addEventListener('click', () => document.getElementById('sidebar').classList.add('open'));
        document.addEventListener('click', e => { if(window.innerWidth<=768 && !e.target.closest('.sidebar') && !e.target.closest('#menu-toggle')) document.getElementById('sidebar').classList.remove('open'); });
        document.getElementById('main-scroll').addEventListener('scroll', () => {
            const m = document.getElementById('main-scroll');
            document.getElementById('progress-bar').style.width = (m.scrollTop / (m.scrollHeight - m.clientHeight)) * 100 + '%';
            document.getElementById('top-fab').classList.toggle('visible', m.scrollTop > 300);
        });
        document.getElementById('top-fab').addEventListener('click', () => document.getElementById('main-scroll').scrollTo({top:0, behavior:'smooth'}));
    </script>
</body>
</html>
