<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阿里山林業鐵路選址策略與災害潛勢分析</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paper: '#F9F7F2',       // 米黃色背景 (紙張質感)
                        forest: '#2F5D40',      // 深森林綠 (主色)
                        soil: '#8D6E63',        // 土壤棕 (強調色/圖說)
                        ink: '#2D2D2D',         // 深灰 (內文)
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'], // 標題用襯線體
                        sans: ['"Noto Sans TC"', 'sans-serif'], // 內文用無襯線體
                    }
                }
            }
        }
    </script>

    <style>
        /* 全局設定 */
        body {
            background-color: #F9F7F2;
            color: #2D2D2D;
            -webkit-font-smoothing: antialiased;
        }

        /* 閱讀進度條樣式 */
        #progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: transparent;
            z-index: 50;
        }
        #progress-bar {
            height: 100%;
            background: #2F5D40;
            width: 0%;
            transition: width 0.1s;
        }

        /* 參考文獻懸掛縮排 (Hanging Indent) */
        .hanging-indent {
            padding-left: 2em;
            text-indent: -2em;
            margin-bottom: 0.5em;
        }

        /* 圖片燈箱過渡效果 */
        .lightbox-overlay {
            transition: opacity 0.3s ease;
        }
        
        /* 手機版優化：圖片不切邊 */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        /* 回到頂部按鈕的焦點樣式 */
        #back-to-top:focus {
            outline: 4px solid #8D6E63; 
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(47, 93, 64, 0.5); 
        }

        /* PDF 嵌入容器樣式 */
        .pdf-viewer {
            width: 100%;
            height: 700px; /* 設定預覽高度 */
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

     /* --- 修改後的時序地圖樣式 (解決圖例消失與閃爍問題版) --- */
        .timelapse-wrapper {
            position: relative;
            width: 100%;
            /* 16:9 比例 (56.25%) */
            padding-bottom: 56.25%; 
            background-color: #d8e3e6; 
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* 修正點：只針對有 .tl-frame class 的圖片進行全螢幕拉伸與隱藏 */
        .timelapse-wrapper img.tl-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; 
            
            /* 預設隱藏 */
            opacity: 0;
            z-index: 1; /* 預設層級 */
            
            /* 移除 transition (解決閃爍) */
            transition: none; 
            
            /* 效能優化 */
            will-change: opacity;
        }

        .timelapse-wrapper img.tl-frame.active {
            /* 顯示時 */
            opacity: 1;
            z-index: 10; /* 確保顯示的圖永遠壓在舊圖上面 */
        }
        
        /* 自定義滑桿樣式 */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2F5D40; 
            cursor: pointer;
            margin-top: -8px; 
            border: 2px solid #F9F7F2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #d1d5db;
            border-radius: 2px;
        }
    </style>
</head>
<body class="font-sans text-lg md:text-xl leading-relaxed selection:bg-forest selection:text-white">

    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <main class="max-w-3xl mx-auto px-6 py-12 md:py-20">

        <header class="mb-12 text-center border-b-2 border-forest pb-8">
            <h1 class="font-serif text-3xl md:text-5xl font-bold text-forest mb-4 leading-tight">
                阿里山林業鐵路<br>選址策略與災害潛勢分析
            </h1>
            <div class="text-soil font-serif text-base md:text-lg space-y-2">
                <p class="font-bold">國立嘉義大學數位學習設計與管理學系</p>
                <p>作者：葉怡嫻、朱書靚、劉芷瑩</p>
                <p>指導教授：李佩倫 教授</p>
            </div>
        </header>

        <section class="mb-12">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-6 border-l-4 border-soil pl-4">壹、林鐵選址與土地利用</h2>
            
            <p class="mb-6 text-justify">
                阿里山林業鐵路的興建與選址策略是日本殖民政府進行大規模山林資源開發與殖民統治的重要政策產物。為了有效運輸高山地區豐富的林木資源，早期的選址經過了詳盡的探勘與評估。根據當時的調查報告，阿里山區擁有廣大的原始檜木林，估計闊葉林材積達 1,728,660 立方公尺。當時總督府決定採用美國式鐵道運材方案來運輸材積大且長度長的珍貴紅檜。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/ksySn2jb/image.png" alt="圖一、阿里山林鐵選址與林木資源空間分佈疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖一、阿里山林鐵選址與林木資源空間分佈疊合圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                早期的探勘路線（如飯田豐二等人經清水溪上游的路線）雖然路徑較短，直線距離看起來最具效益。然而，若從高度剖面圖比較（圖二）可見，該路線末端幾乎呈垂直爬升，這在當時的鐵道工程技術上是極大的挑戰，甚至是不可行的。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/qYS5HfVp/image.png" alt="圖二、探勘路線與現行路線高度剖面圖比較" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖二、探勘路線與現行路線高度剖面圖比較
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                進一步檢視地形分析圖，我們可以更清楚地理解為何當時的工程師放棄了清水溪路線。大塔山斷崖的存在形成了一道天然的屏障。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/HD4fLjdq/image.png" alt="圖三、清水溪探勘路線與大塔山斷崖地形分析圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖三、清水溪探勘路線與大塔山斷崖地形分析圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                而從豐山休息區視角的3D地形圖來看，斷崖的險峻程度一目了然，這解釋了為何最終路線選擇繞行較遠但坡度相對平緩的路徑。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/7NB49085/image.png" alt="圖四、豐山休息區看大塔山斷崖圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖四、豐山休息區看大塔山斷崖圖
                </figcaption>
            </figure>
        </section>

        <section class="mb-16 bg-white p-6 rounded-lg shadow-lg border border-gray-200">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 flex items-center">
                <span class="mr-2">⏱️</span> 時序地貌變遷模擬
            </h3>
            <p class="mb-4 text-base text-gray-600">
                透過下方的時間軸滑桿，您可以動態觀察該區域隨時間推移的地貌變化。
            </p>
            
            <div class="viewer-container w-full">
               <div class="timelapse-wrapper mb-4" id="tl-imageContainer">
                    <div class="absolute inset-0 flex items-center justify-center text-gray-500 z-10" id="tl-loadingText">
                        影像載入中...
                    </div>
                    
                    <img src="https://i.ibb.co/TMM4h7pN/message-Image-1766500338049.jpg" 
                         alt="災害潛勢圖例" 
                         class="absolute top-2 right-2 md:top-4 md:right-4 z-50 w-24 md:w-32 rounded shadow-lg border border-gray-200 bg-white/90 pointer-events-none select-none">
                    </div>

                <div class="controls flex flex-col gap-4">
                    <input type="range" id="tl-slider" min="0" max="48" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    
                    <div class="flex justify-between items-center">
                        <button id="tl-playBtn" class="bg-forest hover:bg-[#234a31] text-white font-medium py-2 px-6 rounded transition-colors flex items-center gap-2 shadow-md">
                            <span>▶ 播放</span>
                        </button>
                        <div class="text-soil font-serif font-bold text-lg">
                            <span id="tl-currentIdx">0000</span> / 0048
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">二、選線工法與經營策略的轉變</h3>
            
            <p class="mb-6 text-justify">
                為了克服急劇爬升的地形，工程師河合鈰太郎發揮了極致的創意與工程技術。如圖五所示，河合在獨立山路段的規劃上採用了複雜的螺旋線工法，讓火車以迴旋方式攀升，不僅解決了高度差問題，也成為今日世界登山鐵道的經典案例。同時，這段路線也與當時的樟腦產業範圍高度重疊，顯示選線除了地形考量外，也兼顧了產業運輸的需求。隨著時代變遷，林業功能逐漸退場，林鐵的經營策略也隨之轉型，從單純的資源掠奪工具，轉變為觀光休閒與文化資產保存的載體，最終成為今日我們所見的世界級登山鐵道。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/LhCm77Wr/image.png" alt="圖五、獨立山螺旋路線與樟腦產業範圍疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖五、獨立山螺旋路線與樟腦產業範圍疊合圖
                </figcaption>
            </figure>
        </section>

        <div class="my-16 bg-white p-4 rounded-lg shadow-inner border border-gray-200">
            <h4 class="text-center font-serif text-forest mb-2 font-bold">林鐵全線海拔高度變化</h4>
            <figure class="group cursor-zoom-in">
                <img src="https://i.ibb.co/YB8776SG/image.png" alt="阿里山林鐵全線剖面圖" class="w-full">
            </figure>
        </div>

        <section class="mb-12">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-6 border-l-4 border-soil pl-4">貳、林鐵與自然災害</h2>
            <p class="mb-6 text-justify">
                阿里山林鐵雖然是工程奇蹟，但也因為穿越了地質破碎帶，長年面臨自然災害的威脅。本章節將分析幾個關鍵路段的地質條件與災害歷史。
            </p>

            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">一、經濟選址的地質代價：獨立山螺旋路段</h3>
            
            <p class="mb-6 text-justify">
                獨立山螺旋線雖然巧妙克服了高度，但也付出了地質代價。根據獨立山段地質災害潛勢圖(圖六），該區域位於多個地層交界處，岩性相對脆弱，屬於崩塌潛勢較高的區域。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/JWPpYMMJ/image.jpg" alt="圖六、獨立山段地質災害潛勢圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖六、獨立山段地質災害潛勢圖
                </figcaption>
            </figure>

            <p class="mb-6 text-justify">
                除了先天脆弱的地質條件，後天的人為開發也加劇了風險。疊合圖顯示，該區域有大量的檳榔種植分布。淺根系的檳榔樹無法有效抓地，在豪雨來襲時，容易導致表土流失，進而誘發土石流或邊坡滑動，對鐵路安全構成嚴重威脅。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/YTF9P8Qz/image.jpg" alt="圖七、獨立山段地質災害潛勢區及檳榔種植分布疊合圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖七、獨立山段地質災害潛勢區及檳榔種植分布疊合圖
                </figcaption>
            </figure>
        </section>

        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">二、速成工法的後遺症：二萬坪順向坡危機</h3>
            
            <p class="mb-6 text-justify">
                二萬坪路段是林鐵歷史上災害最頻繁的區域之一。從地質地形分析(圖八）來看，該路段位於標準的「順向坡」地形上。岩層的傾斜方向與坡面方向一致，一旦坡腳受到侵蝕或地下水壓升高，岩層極易沿著層面滑動，造成大規模走山。這也是為何二萬坪車站曾多次發生路基流失的主要原因。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/F4C5HHry/image.jpg" alt="圖八、二萬坪至屏遮那段地質分析圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖八、二萬坪至屏遮那段地質分析圖
                </figcaption>
            </figure>
        </section>

        <section class="mb-12">
            <h3 class="font-serif text-xl md:text-2xl font-bold text-forest mb-4 mt-8">三、開發的長期環境效應：眠月線的時空變遷</h3>
            
            <p class="mb-6 text-justify">
                眠月線曾是熱門的觀光支線，但在921大地震後嚴重受損。透過關鍵時間點的衛星影像監測（圖九），我們可以清楚看見地貌的劇烈變化。對比1996年災前與1999年震後的影像，原本翠綠的山林出現了大面積的崩塌地，鐵路路基被土石掩埋或沖毀。這些影像證據說明了地震與後續颱風對脆弱地質造成的不可逆破壞。
            </p>

            <figure class="mb-10 group cursor-zoom-in">
                <img src="https://i.ibb.co/35gMZ814/image.jpg" alt="圖九、1996年災前與1999年震後眠月線衛星影像崩塌對比圖" class="shadow-lg hover:shadow-xl transition-shadow duration-300">
                <figcaption class="text-soil text-sm md:text-base text-center mt-3 font-medium italic">
                    圖九、1996年災前與1999年震後眠月線衛星影像崩塌對比圖
                </figcaption>
            </figure>
        </section>

        <hr class="border-t-2 border-forest opacity-30 my-12">

        <section class="mb-12">
            <h2 class="font-serif text-2xl font-bold text-forest mb-6">參、參考資料</h2>
            <div class="text-base text-gray-600 font-serif leading-relaxed">
                <p class="hanging-indent">洪致文 (2014)。《阿里山森林鐵路：世界遺產鐵道》。台北：行政院農業委員會林務局。</p>
                <p class="hanging-indent">蘇昭旭 (2012)。《阿里山森林鐵路與台灣林業文化》。嘉義：嘉義林管處。</p>
                <p class="hanging-indent">賴明洲 (2000)。〈阿里山地區地質災害與植被變遷之研究〉。《台灣林業科學》，15(3)，321-335。</p>
                <p class="hanging-indent">阿里山林業鐵路及文化資產管理處 (2023)。《阿里山林業鐵路歷史沿革》。取自 https://afrch.forest.gov.tw</p>
            </div>
        </section>

        <section class="mb-20">
            <h2 class="font-serif text-2xl md:text-3xl font-bold text-forest mb-8 border-l-4 border-soil pl-4">肆、專題成果展示與下載</h2>
            
            <div class="space-y-12">
                <div class="bg-paper p-6 rounded-lg shadow-xl border border-forest/20">
                    <h3 class="font-serif text-xl font-bold text-forest mb-4">專題文檔（完整版 PDF 預覽）</h3>
                    <p class="text-sm text-soil mb-4">
                        文件 ID: 1ZqXuLs7DEQ8HlajJm_PZhnBDhtfb96O1
                    </p>
                    <iframe 
                        src="https://drive.google.com/file/d/1ZqXuLs7DEQ8HlajJm_PZhnBDhtfb96O1/preview" 
                        class="pdf-viewer" 
                        frameborder="0"
                        title="專題文檔 PDF 預覽"
                    >
                        <p>您的瀏覽器不支援內嵌框架 (iframe)。請點擊 <a href="https://drive.google.com/file/d/1ZqXuLs7DEQ8HlajJm_PZhnBDhtfb96O1/view?usp=sharing" class="text-forest underline" target="_blank">此處下載文檔 PDF</a>。</p>
                    </iframe>
                    <div class="mt-4 text-center">
                        <a href="https://drive.google.com/file/d/1ZqXuLs7DEQ8HlajJm_PZhnBDhtfb96O1/view?usp=sharing" download class="inline-block bg-soil text-white font-sans font-medium py-2 px-6 rounded hover:bg-soil/90 transition-colors">
                            下載專題文檔 PDF
                        </a>
                    </div>
                </div>

                <div class="bg-paper p-6 rounded-lg shadow-xl border border-forest/20">
                    <h3 class="font-serif text-xl font-bold text-forest mb-4">專題海報（PDF 預覽）</h3>
                    <p class="text-sm text-soil mb-4">
                        海報 ID: 1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a
                    </p>
                    <iframe 
                        src="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/preview" 
                        class="pdf-viewer" 
                        frameborder="0"
                        title="專題海報 PDF 預覽"
                    >
                        <p>您的瀏覽器不支援內嵌框架 (iframe)。請點擊 <a href="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/view?usp=sharing" class="text-forest underline" target="_blank">此處下載海報 PDF</a>。</p>
                    </iframe>
                    <div class="mt-4 text-center">
                        <a href="https://drive.google.com/file/d/1jypJDVKaVvPJYVtroiD6NekGTiU6TX7a/view?usp=sharing" download class="inline-block bg-soil text-white font-sans font-medium py-2 px-6 rounded hover:bg-soil/90 transition-colors">
                            下載專題海報 PDF
                        </a>
                    </div>
                </div>
            </div>

        </section>
        <footer class="text-center text-sm text-gray-500 py-8 border-t border-gray-300">
            <p>© 2024 國立嘉義大學數位學習設計與管理學系專題製作</p>
        </footer>

    </main>

    <button id="back-to-top" class="fixed bottom-6 right-6 bg-forest text-white p-4 rounded-full shadow-lg opacity-0 transition-opacity duration-300 hover:bg-opacity-90 z-40 hidden md:block" aria-label="回到頂部" title="回到頂部 (Top)">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden flex justify-center items-center opacity-0 lightbox-overlay" role="dialog" aria-modal="true">
        <button id="lightbox-close" class="absolute top-4 right-4 text-white p-2 hover:text-soil transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <div class="max-w-5xl max-h-screen p-4 flex flex-col items-center">
            <img id="lightbox-img" src="" alt="放大預覽" class="max-h-[85vh] w-auto object-contain rounded shadow-2xl">
            <p id="lightbox-caption" class="text-gray-300 mt-4 text-lg font-serif text-center"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            /* ========================================= */
            /* 1. 時序地圖 (Timelapse Map) 邏輯           */
            /* ========================================= */
            const tlContainer = document.getElementById('tl-imageContainer');
            const tlSlider = document.getElementById('tl-slider');
            const tlPlayBtn = document.getElementById('tl-playBtn');
            const tlCurrentIdxDisplay = document.getElementById('tl-currentIdx');
            const tlLoadingText = document.getElementById('tl-loadingText');

            // 設定區：根據需求修改為 png 檔名
            const config = {
                folder: 'TimeMap',  // 資料夾名稱
                total: 49,          // 0000 到 0048 共 49 張
                ext: '.png',        // 這裡設定為 png
                speed: 150          // 播放速度
            };

            let tlImages = [];
            let isPlaying = false;
            let playInterval = null;

            // 產生路徑並預載入
            function initTimelapse() {
                let loadedCount = 0;
                
                for (let i = 0; i < config.total; i++) {
                    // 將數字轉為 4 位數格式 (例如 0 -> 0000, 1 -> 0001)
                    const numStr = String(i).padStart(4, '0');
                    const path = `${config.folder}/${numStr}${config.ext}`;

                    const img = document.createElement('img');
                    img.src = path;
                    img.alt = `Time Point ${numStr}`;
                    
                    /* 修正關鍵：加入 class 讓 CSS 辨識這是地圖影格 */
                    img.classList.add('tl-frame');
                    
                    if (i === 0) img.classList.add('active');

                    img.onload = () => {
                        loadedCount++;
                        if (loadedCount === config.total) {
                            tlLoadingText.style.display = 'none';
                        }
                    };
                    
                    img.onerror = () => {
                        console.warn(`找不到圖片: ${path}`);
                    }

                    tlContainer.appendChild(img);
                    tlImages.push(img);
                }
            }

            function updateFrame(index) {
                // 移除舊的 active
                const currentActive = tlContainer.querySelector('.active');
                if (currentActive) currentActive.classList.remove('active');
                
                // 加上新的 active
                if (tlImages[index]) {
                    tlImages[index].classList.add('active');
                    tlCurrentIdxDisplay.textContent = String(index).padStart(4, '0');
                }
            }

            function togglePlay() {
                if (isPlaying) {
                    clearInterval(playInterval);
                    tlPlayBtn.innerHTML = '<span>▶ 播放</span>';
                    isPlaying = false;
                } else {
                    tlPlayBtn.innerHTML = '<span>❚❚ 暫停</span>';
                    isPlaying = true;
                    playInterval = setInterval(() => {
                        let nextVal = parseInt(tlSlider.value) + 1;
                        if (nextVal >= config.total) nextVal = 0;
                        tlSlider.value = nextVal;
                        updateFrame(nextVal);
                    }, config.speed);
                }
            }

            // 事件監聽
            tlSlider.addEventListener('input', (e) => {
                // 拖動時暫停播放，避免干擾
                if (isPlaying) togglePlay();
                updateFrame(parseInt(e.target.value));
            });

            tlPlayBtn.addEventListener('click', togglePlay);

            // 啟動時序地圖
            initTimelapse();


            /* ========================================= */
            /* 2. 原有的 UI 邏輯 (進度條、燈箱等)          */
            /* ========================================= */
            
            // 閱讀進度條
            const progressBar = document.getElementById('progress-bar');
            window.addEventListener('scroll', () => {
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrollPercent = (scrollTop / scrollHeight) * 100;
                progressBar.style.width = scrollPercent + '%';
            });

            // 回到頂部按鈕
            const backToTopBtn = document.getElementById('back-to-top');
            const checkScrollPosition = () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.remove('opacity-0');
                    backToTopBtn.setAttribute('tabindex', '0'); 
                } else {
                    backToTopBtn.classList.add('opacity-0');
                    backToTopBtn.setAttribute('tabindex', '-1');
                }
            };
            backToTopBtn.setAttribute('tabindex', '-1'); 
            window.addEventListener('scroll', checkScrollPosition);
            window.addEventListener('load', checkScrollPosition); 

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Lightbox (燈箱)
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const closeBtn = document.getElementById('lightbox-close');
            
            // 注意：這裡只選擇 main figure 下的 img，這樣就不會選到 timelapse 的圖片
            const contentImages = document.querySelectorAll('main figure img');

            const openLightbox = (src, alt) => {
                lightboxImg.src = src;
                lightboxCaption.textContent = alt;
                lightbox.classList.remove('hidden');
                requestAnimationFrame(() => {
                    lightbox.classList.remove('opacity-0');
                });
                document.body.style.overflow = 'hidden'; 
                closeBtn.focus(); 
            };

            const closeLightbox = () => {
                lightbox.classList.add('opacity-0');
                setTimeout(() => {
                    lightbox.classList.add('hidden');
                    lightboxImg.src = '';
                }, 300); 
                document.body.style.overflow = '';
            };

            contentImages.forEach(img => {
                const figure = img.closest('figure');
                if(!figure) return; // 安全檢查

                figure.addEventListener('click', (e) => { 
                    e.stopPropagation(); 
                    openLightbox(img.src, img.alt);
                });
                
                figure.setAttribute('tabindex', '0');
                figure.setAttribute('role', 'button');
                figure.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        openLightbox(img.src, img.alt);
                    }
                });
            });

            closeBtn.addEventListener('click', closeLightbox);
            
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox && e.target !== lightboxImg) {
                    closeLightbox();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !lightbox.classList.contains('hidden')) {
                    closeLightbox();
                }
            });
        });
    </script>
</body>
</html>
